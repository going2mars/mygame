{"version":3,"sources":["../file:/D:/CocosEditors/Creator/3.8.4/resources/resources/3d/engine/editor/assets/default_renderpipeline/file:/D:/CocosEditors/Creator/3.8.4/resources/resources/3d/engine/editor/assets/default_renderpipeline/builtin-pipeline-settings.ts","../file:/D:/CocosEditors/Creator/3.8.4/resources/resources/3d/engine/editor/assets/default_renderpipeline/file:/D:/CocosEditors/Creator/3.8.4/resources/resources/3d/engine/editor/assets/default_renderpipeline/builtin-pipeline-types.ts","../file:/D:/CocosEditors/Creator/3.8.4/resources/resources/3d/engine/editor/assets/default_renderpipeline/file:/D:/CocosEditors/Creator/3.8.4/resources/resources/3d/engine/editor/assets/default_renderpipeline/builtin-pipeline.ts"],"names":["ccclass","_decorator","disallowMultiple","executeInEditMode","menu","property","requireComponent","type","BuiltinPipelineSettings","_dec","_dec2","_dec3","Camera","_dec4","CCBoolean","_dec5","displayName","_dec6","group","id","name","_dec7","style","CCInteger","range","_dec8","_dec9","tooltip","CCFloat","slide","_dec10","visible","_dec11","Material","_dec12","min","_dec13","_dec14","_dec15","_dec16","_dec17","_dec18","_dec19","_dec20","_dec21","_dec22","_dec23","_dec24","Texture2D","_dec25","_dec26","_dec27","_dec28","_dec29","_dec30","_class","_class2","_Component","_inheritsLoose","_this","_len","arguments","length","args","Array","_key","call","apply","concat","_initializerDefineProperty","_descriptor","_assertThisInitialized","_descriptor2","_proto","prototype","onEnable","fillRequiredPipelineSettings","_settings","cameraComponent","getComponent","camera","pipelineSettings","onDisable","_tryEnableEditorPreview","rendering","undefined","_editorPreview","setEditorPipelineSettings","_disableEditorPreview","current","getEditorPipelineSettings","_createClass","key","get","set","v","msaa","enabled","value","sampleCount","Math","pow","ceil","log2","max","enableShadingScale","shadingScale","depthOfField","material","focusDistance","focusRange","bokehRadius","bloom","enableAlphaMask","iterations","threshold","intensity","colorGrading","contribute","colorGradingMap","val","fxaa","fsr","sharpness","toneMapping","Component","_applyDecoratedDescriptor","configurable","enumerable","writable","initializer","makePipelineSettings","Object","getOwnPropertyDescriptor","_RF","pop","SampleCount","gfx","makeMSAA","X4","fillRequiredMSAA","makeHBAO","radiusScale","angleBiasDegree","blurSharpness","aoSaturation","needBlur","fillRequiredHBAO","makeDepthOfField","fillRequiredDepthOfField","makeBloom","fillRequiredBloom","makeColorGrading","fillRequiredColorGrading","makeFSR","fillRequiredFSR","makeFXAA","fillRequiredFXAA","makeToneMapping","fillRequiredToneMapping","AABB","geometry","Sphere","intersect","ClearFlagBit","Color","Format","FormatFeatureBit","LoadOp","StoreOp","TextureType","Viewport","scene","renderer","CameraUsage","CSMLevel","LightType","forwardNeedClearColor","clearFlag","COLOR","STENCIL","getCsmMainLightViewport","light","w","h","level","vp","screenSpaceSignY","shadowFixedArea","csmLevel","LEVEL_1","left","top","width","trunc","height","floor","PipelineConfigs","isWeb","isWebGL1","isWebGPU","isMobile","isHDR","useFloatOutput","toneMappingType","shadowEnabled","shadowMapFormat","R32F","shadowMapSize","Vec2","usePlanarShadow","supportDepthSample","mobileMaxSpotLightShadowMaps","platform","Vec4","setupPipelineConfigs","ppl","configs","sampleFeature","SAMPLED_TEXTURE","LINEAR_FILTER","device","sys","isNative","gfxAPI","API","WEBGL","WEBGPU","pipelineSceneData","getMacroBool","postSettings","shadowInfo","shadows","pipeline","supportsR32FloatTexture","RGBA8","size","ShadowType","Planar","capabilities","getFormatFeatures","DEPTH_STENCIL","x","clipSpaceSignY","defaultSettings","CameraConfigs","colorName","depthStencilName","enableMainLightShadowMap","enableMainLightPlanarShadowMap","enablePostProcess","enableProfiler","enableMSAA","enableDOF","enableBloom","enableColorGrading","enableFXAA","enableFSR","enableHDR","enablePlanarReflectionProbe","useFullPipeline","singleForwardRadiancePass","radianceFormat","settings","setupPostProcessConfigs","pipelineConfigs","cameraConfigs","setupCameraConfigs","window","isMainGameWindow","cameraUsage","GAME","swapchain","isEditorView","SCENE_VIEW","PREVIEW","visibility","Layers","Enum","DEFAULT","mainLight","editorSettings","RGBA16F","QueueHint","SceneFlags","ResourceFlags","ResourceResidency","ForwardLighting","lights","shadowEnabledSpotLights","_sphere","create","_boundingBox","_rangedDirLightBoundingBox","cullLights","frustum","cameraPos","_iterator","_createForOfIteratorHelperLoose","spotLights","_step","done","baked","position","y","z","sphereFrustum","push","_iterator2","sphereLights","_step2","_iterator3","pointLights","_step3","_iterator4","rangedDirLights","_step4","transform","node","getWorldMatrix","aabbFrustum","sort","lhs","rhs","Vec3","squaredDistance","_addLightQueues","pass","_iterator5","_step5","queue","addQueue","BLEND","SPHERE","SPOT","POINT","RANGED_DIRECTIONAL","addScene","addSpotlightShadowPasses","maxNumShadowMaps","i","_iterator6","_step6","shadowPass","addRenderPass","addRenderTarget","CLEAR","STORE","addDepthStencil","DISCARD","NONE","OPAQUE","MASK","SHADOW_CASTER","useLightFrustum","addLightQueues","_iterator7","_step7","addTexture","addLightPasses","depthStencilStoreOp","viewport","count","_iterator8","_step8","storeOp","setViewport","LOAD","isMultipleLightPassesNeeded","BuiltinPipelineBuilder","_pipelineEvent","cclegacy","director","root","pipelineEvent","_clearColor","_clearColorTransparentBlack","_reflectionProbeClearColor","_viewport","_configs","_cameraConfigs","_cocParams","_cocTexSize","_bloomParams","_bloomTexSize","_bloomWidths","_bloomHeights","_bloomTexNames","_colorGradingTexSize","_fxaaParams","_fsrParams","_fsrTexSize","_copyAndTonemapMaterial","_initialized","forwardLighting","_proto2","windowResize","nativeWidth","nativeHeight","renderWindowId","addRenderWindow","TEX2D","COLOR_ATTACHMENT","MEMORYLESS","DEPTH_STENCIL_ATTACHMENT","halfWidth","halfHeight","bloomWidth","bloomHeight","setProperty","setup","cameras","_initMaterials","_iterator9","_step9","emit","PipelineEventType","RENDER_CAMERA_BEGIN","_buildForwardPipeline","_buildSimplePipeline","RENDER_CAMERA_END","round","clearColor","clearDepth","clearStencil","flags","UI","PROFILER","showStatistics","sceneDepth","radianceName","ldrColorName","assert","_addCascadedShadowMapPass","_tryAddReflectionProbePasses","lastPass","dofRadianceName","_addForwardRadiancePasses","_addDepthOfFieldPasses","_addKawaseDualFilterBloomPasses","copyAndTonemapPassNeeded","ldrColorBufferName","_addCopyAndTonemapPass","aaColorName","_addFxaaPass","_addFsrPass","_addCopyPass","_addTonemapResizeOrSuperResolutionPasses","_addUIQueue","csmSupported","input","output","setVec4","addFullscreenQuad","lutTex","isSquareMap","setVec2","setFloat","_buildForwardMainLightPass","colorStoreOp","warn","dofMaterial","depthStencil","cocName","prefilterName","bokehName","filterName","cocPass","setMat4","matProj","addCameraQuad","prefilterPass","bokehPass","filterPass","combinePass","bloomMaterial","sizeCount","downPass","upPass","fsrMaterial","clamp","fsrColorName","easuPass","rcasPass","fxaaMaterial","disableMSAA","_addForwardSingleRadiancePass","_addForwardMultipleRadiancePasses","addPlanarShadowQueue","sceneFlags","geometryRenderer","GEOMETRY","msaaRadianceName","msaaDepthStencilName","msPass","addMultisampleRenderPass","resolveRenderTarget","PLANAR_SHADOW","firstStoreOp","_buildReflectionProbePass","packRGBE","REFLECTION_PROBE","reflectionProbeManager","internal","probes","getProbes","maxProbeCount","probeID","_iterator10","_step10","probe","needRender","area","renderArea","probeType","ProbeType","PLANAR","realtimePlanarTexture","probePass","_uuid","initialize","effectName","effectAsset","setCustomPipeline"],"mappings":"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","file":"all.js","sourcesContent":["/*\r\n Copyright (c) 2021-2024 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport {\r\n    _decorator,\r\n    Camera,\r\n    CCBoolean,\r\n    CCFloat,\r\n    CCInteger,\r\n    Component,\r\n    Material,\r\n    rendering,\r\n    Texture2D,\r\n} from 'cc';\r\n\r\nimport { EDITOR } from 'cc/env';\r\n\r\nimport {\r\n    PipelineSettings,\r\n    makePipelineSettings,\r\n    fillRequiredPipelineSettings,\r\n} from './builtin-pipeline-types';\r\n\r\nconst { ccclass, disallowMultiple, executeInEditMode, menu, property, requireComponent, type } = _decorator;\r\n\r\n@ccclass('BuiltinPipelineSettings')\r\n@menu('Rendering/BuiltinPipelineSettings')\r\n@requireComponent(Camera)\r\n@disallowMultiple\r\n@executeInEditMode\r\nexport class BuiltinPipelineSettings extends Component {\r\n    @property\r\n    private readonly _settings: PipelineSettings = makePipelineSettings();\r\n\r\n    // Enable/Disable\r\n    onEnable(): void {\r\n        fillRequiredPipelineSettings(this._settings);\r\n        const cameraComponent = this.getComponent(Camera)!;\r\n        const camera = cameraComponent.camera;\r\n        camera.pipelineSettings = this._settings;\r\n\r\n        if (EDITOR) {\r\n            this._tryEnableEditorPreview();\r\n        }\r\n    }\r\n    onDisable(): void {\r\n        const cameraComponent = this.getComponent(Camera)!;\r\n        const camera = cameraComponent.camera;\r\n        camera.pipelineSettings = null;\r\n\r\n        if (EDITOR) {\r\n            this._disableEditorPreview();\r\n        }\r\n    }\r\n\r\n    // Editor Preview\r\n    @property(CCBoolean)\r\n    protected _editorPreview = false;\r\n\r\n    @property({\r\n        displayName: 'Editor Preview (Experimental)',\r\n        type: CCBoolean,\r\n    })\r\n    get editorPreview(): boolean {\r\n        return this._editorPreview;\r\n    }\r\n    set editorPreview(v: boolean) {\r\n        this._editorPreview = v;\r\n        if (EDITOR) {\r\n            this._tryEnableEditorPreview();\r\n        }\r\n    }\r\n    private _tryEnableEditorPreview(): void {\r\n        if (rendering === undefined) {\r\n            return;\r\n        }\r\n        if (this._editorPreview) {\r\n            rendering.setEditorPipelineSettings(this._settings);\r\n        } else {\r\n            this._disableEditorPreview();\r\n        }\r\n    }\r\n    private _disableEditorPreview(): void {\r\n        if (rendering === undefined) {\r\n            return;\r\n        }\r\n        const current = rendering.getEditorPipelineSettings() as PipelineSettings | null;\r\n        if (current === this._settings) {\r\n            rendering.setEditorPipelineSettings(null);\r\n        }\r\n    }\r\n\r\n    // MSAA\r\n    @property({\r\n        group: { id: 'MSAA', name: 'Multisample Anti-Aliasing' },\r\n        type: CCBoolean,\r\n    })\r\n    get MsaaEnable(): boolean {\r\n        return this._settings.msaa.enabled;\r\n    }\r\n    set MsaaEnable(value: boolean) {\r\n        this._settings.msaa.enabled = value;\r\n        if (EDITOR) {\r\n            this._tryEnableEditorPreview();\r\n        }\r\n    }\r\n\r\n    @property({\r\n        group: { id: 'MSAA', name: 'Multisample Anti-Aliasing', style: 'section' },\r\n        type: CCInteger,\r\n        range: [2, 4, 2],\r\n    })\r\n    set msaaSampleCount(value: number) {\r\n        value = 2 ** Math.ceil(Math.log2(Math.max(value, 2)));\r\n        value = Math.min(value, 4);\r\n        this._settings.msaa.sampleCount = value;\r\n        if (EDITOR) {\r\n            this._tryEnableEditorPreview();\r\n        }\r\n    }\r\n    get msaaSampleCount(): number {\r\n        return this._settings.msaa.sampleCount;\r\n    }\r\n\r\n    // Shading Scale\r\n    @property({\r\n        group: { id: 'ShadingScale', name: 'ShadingScale', style: 'section' },\r\n        type: CCBoolean,\r\n    })\r\n    set shadingScaleEnable(value: boolean) {\r\n        this._settings.enableShadingScale = value;\r\n        if (EDITOR) {\r\n            this._tryEnableEditorPreview();\r\n        }\r\n    }\r\n    get shadingScaleEnable(): boolean {\r\n        return this._settings.enableShadingScale;\r\n    }\r\n\r\n    @property({\r\n        tooltip: 'i18n:postprocess.shadingScale',\r\n        group: { id: 'ShadingScale', name: 'ShadingScale' },\r\n        type: CCFloat,\r\n        range: [0.01, 4, 0.01],\r\n        slide: true,\r\n    })\r\n    set shadingScale(value: number) {\r\n        this._settings.shadingScale = value;\r\n        if (EDITOR) {\r\n            this._tryEnableEditorPreview();\r\n        }\r\n    }\r\n    get shadingScale(): number {\r\n        return this._settings.shadingScale;\r\n    }\r\n\r\n    // DepthOfField\r\n    @property({\r\n        group: { id: 'DepthOfField', name: 'DepthOfField (PostProcessing)', style: 'section' },\r\n        type: CCBoolean,\r\n        visible: false,\r\n    })\r\n    set dofEnable(value: boolean) {\r\n        this._settings.depthOfField.enabled = value;\r\n        if (EDITOR) {\r\n            this._tryEnableEditorPreview();\r\n        }\r\n    }\r\n    get dofEnable(): boolean {\r\n        return this._settings.depthOfField.enabled;\r\n    }\r\n\r\n    @property({\r\n        group: { id: 'DepthOfField', name: 'DepthOfField (PostProcessing)', style: 'section' },\r\n        type: Material,\r\n        visible: false,\r\n    })\r\n    set dofMaterial(value: Material) {\r\n        if (this._settings.depthOfField.material === value) {\r\n            return;\r\n        }\r\n        this._settings.depthOfField.material = value;\r\n        if (EDITOR) {\r\n            this._tryEnableEditorPreview();\r\n        }\r\n    }\r\n    get dofMaterial(): Material {\r\n        return this._settings.depthOfField.material!;\r\n    }\r\n\r\n    @property({\r\n        group: { id: 'DepthOfField', name: 'DepthOfField (PostProcessing)', style: 'section' },\r\n        type: CCFloat,\r\n        min: 0,\r\n        visible: false,\r\n    })\r\n    set dofFocusDistance(value: number) {\r\n        this._settings.depthOfField.focusDistance = value;\r\n    }\r\n    get dofFocusDistance(): number {\r\n        return this._settings.depthOfField.focusDistance;\r\n    }\r\n\r\n    @property({\r\n        group: { id: 'DepthOfField', name: 'DepthOfField (PostProcessing)', style: 'section' },\r\n        type: CCFloat,\r\n        min: 0,\r\n        visible: false,\r\n    })\r\n    set dofFocusRange(value: number) {\r\n        this._settings.depthOfField.focusRange = value;\r\n    }\r\n    get dofFocusRange(): number {\r\n        return this._settings.depthOfField.focusRange;\r\n    }\r\n\r\n    @type(CCFloat)\r\n    @property({\r\n        group: { id: 'DepthOfField', name: 'DepthOfField (PostProcessing)', style: 'section' },\r\n        type: CCFloat,\r\n        range: [1, 10, 0.01],\r\n        slide: true,\r\n        visible: false,\r\n    })\r\n    set dofBokehRadius(value: number) {\r\n        this._settings.depthOfField.bokehRadius = value;\r\n    }\r\n    get dofBokehRadius(): number {\r\n        return this._settings.depthOfField.bokehRadius;\r\n    }\r\n\r\n    // Bloom\r\n    @property({\r\n        group: { id: 'Bloom', name: 'Bloom (PostProcessing)', style: 'section' },\r\n        type: CCBoolean,\r\n    })\r\n    set bloomEnable(value: boolean) {\r\n        this._settings.bloom.enabled = value;\r\n        if (EDITOR) {\r\n            this._tryEnableEditorPreview();\r\n        }\r\n    }\r\n    get bloomEnable(): boolean {\r\n        return this._settings.bloom.enabled;\r\n    }\r\n\r\n    @property({\r\n        group: { id: 'Bloom', name: 'Bloom (PostProcessing)', style: 'section' },\r\n        type: Material,\r\n    })\r\n    set bloomMaterial(value: Material) {\r\n        if (this._settings.bloom.material === value) {\r\n            return;\r\n        }\r\n        this._settings.bloom.material = value;\r\n        if (EDITOR) {\r\n            this._tryEnableEditorPreview();\r\n        }\r\n    }\r\n    get bloomMaterial(): Material {\r\n        return this._settings.bloom.material!;\r\n    }\r\n\r\n    @property({\r\n        tooltip: 'i18n:bloom.enableAlphaMask',\r\n        group: { id: 'Bloom', name: 'Bloom (PostProcessing)', style: 'section' },\r\n        type: CCBoolean,\r\n    })\r\n    set bloomEnableAlphaMask(value: boolean) {\r\n        this._settings.bloom.enableAlphaMask = value;\r\n        if (EDITOR) {\r\n            this._tryEnableEditorPreview();\r\n        }\r\n    }\r\n    get bloomEnableAlphaMask(): boolean {\r\n        return this._settings.bloom.enableAlphaMask;\r\n    }\r\n\r\n    @property({\r\n        tooltip: 'i18n:bloom.iterations',\r\n        group: { id: 'Bloom', name: 'Bloom (PostProcessing)', style: 'section' },\r\n        type: CCInteger,\r\n        range: [1, 6, 1],\r\n        slide: true,\r\n    })\r\n    set bloomIterations(value: number) {\r\n        this._settings.bloom.iterations = value;\r\n        if (EDITOR) {\r\n            this._tryEnableEditorPreview();\r\n        }\r\n    }\r\n    get bloomIterations(): number {\r\n        return this._settings.bloom.iterations;\r\n    }\r\n\r\n    @property({\r\n        tooltip: 'i18n:bloom.threshold',\r\n        group: { id: 'Bloom', name: 'Bloom (PostProcessing)', style: 'section' },\r\n        type: CCFloat,\r\n        min: 0,\r\n    })\r\n    set bloomThreshold(value: number) {\r\n        this._settings.bloom.threshold = value;\r\n    }\r\n    get bloomThreshold(): number {\r\n        return this._settings.bloom.threshold;\r\n    }\r\n\r\n    set bloomIntensity(value: number) {\r\n        this._settings.bloom.intensity = value;\r\n    }\r\n    get bloomIntensity(): number {\r\n        return this._settings.bloom.intensity;\r\n    }\r\n\r\n    // Color Grading (LDR)\r\n    @property({\r\n        group: { id: 'Color Grading', name: 'ColorGrading (LDR) (PostProcessing)', style: 'section' },\r\n        type: CCBoolean,\r\n    })\r\n    set colorGradingEnable(value: boolean) {\r\n        this._settings.colorGrading.enabled = value;\r\n        if (EDITOR) {\r\n            this._tryEnableEditorPreview();\r\n        }\r\n    }\r\n    get colorGradingEnable(): boolean {\r\n        return this._settings.colorGrading.enabled;\r\n    }\r\n\r\n    @property({\r\n        group: { id: 'Color Grading', name: 'ColorGrading (LDR) (PostProcessing)', style: 'section' },\r\n        type: Material,\r\n    })\r\n    set colorGradingMaterial(value: Material) {\r\n        if (this._settings.colorGrading.material === value) {\r\n            return;\r\n        }\r\n        this._settings.colorGrading.material = value;\r\n        if (EDITOR) {\r\n            this._tryEnableEditorPreview();\r\n        }\r\n    }\r\n    get colorGradingMaterial(): Material {\r\n        return this._settings.colorGrading.material!;\r\n    }\r\n\r\n    @property({\r\n        tooltip: 'i18n:color_grading.contribute',\r\n        group: { id: 'Color Grading', name: 'ColorGrading (LDR) (PostProcessing)', style: 'section' },\r\n        type: CCFloat,\r\n        range: [0, 1, 0.01],\r\n        slide: true,\r\n    })\r\n    set colorGradingContribute(value: number) {\r\n        this._settings.colorGrading.contribute = value;\r\n    }\r\n    get colorGradingContribute(): number {\r\n        return this._settings.colorGrading.contribute;\r\n    }\r\n\r\n    @property({\r\n        tooltip: 'i18n:color_grading.originalMap',\r\n        group: { id: 'Color Grading', name: 'ColorGrading (LDR) (PostProcessing)', style: 'section' },\r\n        type: Texture2D,\r\n    })\r\n    set colorGradingMap(val: Texture2D) {\r\n        this._settings.colorGrading.colorGradingMap = val;\r\n        if (EDITOR) {\r\n            this._tryEnableEditorPreview();\r\n        }\r\n    }\r\n    get colorGradingMap(): Texture2D {\r\n        return this._settings.colorGrading.colorGradingMap!;\r\n    }\r\n\r\n    // FXAA\r\n    @property({\r\n        group: { id: 'FXAA', name: 'Fast Approximate Anti-Aliasing (PostProcessing)', style: 'section' },\r\n        type: CCBoolean,\r\n    })\r\n    set fxaaEnable(value: boolean) {\r\n        this._settings.fxaa.enabled = value;\r\n        if (EDITOR) {\r\n            this._tryEnableEditorPreview();\r\n        }\r\n    }\r\n    get fxaaEnable(): boolean {\r\n        return this._settings.fxaa.enabled;\r\n    }\r\n\r\n    @property({\r\n        group: { id: 'FXAA', name: 'Fast Approximate Anti-Aliasing (PostProcessing)', style: 'section' },\r\n        type: Material,\r\n    })\r\n    set fxaaMaterial(value: Material) {\r\n        if (this._settings.fxaa.material === value) {\r\n            return;\r\n        }\r\n        this._settings.fxaa.material = value;\r\n        if (EDITOR) {\r\n            this._tryEnableEditorPreview();\r\n        }\r\n    }\r\n    get fxaaMaterial(): Material {\r\n        return this._settings.fxaa.material!;\r\n    }\r\n\r\n    // FSR\r\n    @property({\r\n        group: { id: 'FSR', name: 'FidelityFX Super Resolution', style: 'section' },\r\n        type: CCBoolean,\r\n    })\r\n    set fsrEnable(value: boolean) {\r\n        this._settings.fsr.enabled = value;\r\n        if (EDITOR) {\r\n            this._tryEnableEditorPreview();\r\n        }\r\n    }\r\n    get fsrEnable(): boolean {\r\n        return this._settings.fsr.enabled;\r\n    }\r\n\r\n    @property({\r\n        group: { id: 'FSR', name: 'FidelityFX Super Resolution', style: 'section' },\r\n        type: Material,\r\n    })\r\n    set fsrMaterial(value: Material) {\r\n        if (this._settings.fsr.material === value) {\r\n            return;\r\n        }\r\n        this._settings.fsr.material = value;\r\n        if (EDITOR) {\r\n            this._tryEnableEditorPreview();\r\n        }\r\n    }\r\n    get fsrMaterial(): Material {\r\n        return this._settings.fsr.material!;\r\n    }\r\n\r\n    @property({\r\n        group: { id: 'FSR', name: 'FidelityFX Super Resolution', style: 'section' },\r\n        type: CCFloat,\r\n        range: [0, 1, 0.01],\r\n        slide: true,\r\n    })\r\n    set fsrSharpness(value: number) {\r\n        this._settings.fsr.sharpness = value;\r\n    }\r\n    get fsrSharpness(): number {\r\n        return this._settings.fsr.sharpness;\r\n    }\r\n\r\n    @property({\r\n        group: { id: 'ToneMapping', name: 'ToneMapping', style: 'section' },\r\n        type: Material,\r\n    })\r\n    set toneMappingMaterial(value: Material) {\r\n        if (this._settings.toneMapping.material === value) {\r\n            return;\r\n        }\r\n        this._settings.toneMapping.material = value;\r\n        if (EDITOR) {\r\n            this._tryEnableEditorPreview();\r\n        }\r\n    }\r\n    get toneMappingMaterial(): Material {\r\n        return this._settings.toneMapping.material!;\r\n    }\r\n}\r\n","/*\r\n Copyright (c) 2021-2024 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\n/**\r\n * ========================= !DO NOT CHANGE THE FOLLOWING SECTION MANUALLY! =========================\r\n * The following section is auto-generated.\r\n * ========================= !DO NOT CHANGE THE FOLLOWING SECTION MANUALLY! =========================\r\n */\r\n/* eslint-disable max-len */\r\nimport { Material, Texture2D, gfx } from 'cc';\r\n\r\nconst { SampleCount } = gfx;\r\n\r\nexport interface MSAA {\r\n    enabled: boolean; /* false */\r\n    sampleCount: gfx.SampleCount; /* SampleCount.X4 */\r\n    [name: string]: unknown;\r\n}\r\n\r\nexport function makeMSAA(): MSAA {\r\n    return {\r\n        enabled: false,\r\n        sampleCount: SampleCount.X4,\r\n    };\r\n}\r\n\r\nexport function fillRequiredMSAA(value: MSAA): void {\r\n    if (value.enabled === undefined) {\r\n        value.enabled = false;\r\n    }\r\n    if (value.sampleCount === undefined) {\r\n        value.sampleCount = SampleCount.X4;\r\n    }\r\n}\r\n\r\nexport interface HBAO {\r\n    enabled: boolean; /* false */\r\n    radiusScale: number; /* 1 */\r\n    angleBiasDegree: number; /* 10 */\r\n    blurSharpness: number; /* 3 */\r\n    aoSaturation: number; /* 1 */\r\n    needBlur: boolean; /* false */\r\n    [name: string]: unknown;\r\n}\r\n\r\nexport function makeHBAO(): HBAO {\r\n    return {\r\n        enabled: false,\r\n        radiusScale: 1,\r\n        angleBiasDegree: 10,\r\n        blurSharpness: 3,\r\n        aoSaturation: 1,\r\n        needBlur: false,\r\n    };\r\n}\r\n\r\nexport function fillRequiredHBAO(value: HBAO): void {\r\n    if (value.enabled === undefined) {\r\n        value.enabled = false;\r\n    }\r\n    if (value.radiusScale === undefined) {\r\n        value.radiusScale = 1;\r\n    }\r\n    if (value.angleBiasDegree === undefined) {\r\n        value.angleBiasDegree = 10;\r\n    }\r\n    if (value.blurSharpness === undefined) {\r\n        value.blurSharpness = 3;\r\n    }\r\n    if (value.aoSaturation === undefined) {\r\n        value.aoSaturation = 1;\r\n    }\r\n    if (value.needBlur === undefined) {\r\n        value.needBlur = false;\r\n    }\r\n}\r\n\r\nexport interface DepthOfField {\r\n    enabled: boolean; /* false */\r\n    /* refcount */ material: Material | null;\r\n    focusDistance: number; /* 0 */\r\n    focusRange: number; /* 0 */\r\n    bokehRadius: number; /* 1 */\r\n    [name: string]: unknown;\r\n}\r\n\r\nexport function makeDepthOfField(): DepthOfField {\r\n    return {\r\n        enabled: false,\r\n        material: null,\r\n        focusDistance: 0,\r\n        focusRange: 0,\r\n        bokehRadius: 1,\r\n    };\r\n}\r\n\r\nexport function fillRequiredDepthOfField(value: DepthOfField): void {\r\n    if (value.enabled === undefined) {\r\n        value.enabled = false;\r\n    }\r\n    if (value.material === undefined) {\r\n        value.material = null;\r\n    }\r\n    if (value.focusDistance === undefined) {\r\n        value.focusDistance = 0;\r\n    }\r\n    if (value.focusRange === undefined) {\r\n        value.focusRange = 0;\r\n    }\r\n    if (value.bokehRadius === undefined) {\r\n        value.bokehRadius = 1;\r\n    }\r\n}\r\n\r\nexport interface Bloom {\r\n    enabled: boolean; /* false */\r\n    /* refcount */ material: Material | null;\r\n    enableAlphaMask: boolean; /* false */\r\n    iterations: number; /* 3 */\r\n    threshold: number; /* 0.8 */\r\n    intensity: number; /* 2.3 */\r\n    [name: string]: unknown;\r\n}\r\n\r\nexport function makeBloom(): Bloom {\r\n    return {\r\n        enabled: false,\r\n        material: null,\r\n        enableAlphaMask: false,\r\n        iterations: 3,\r\n        threshold: 0.8,\r\n        intensity: 2.3,\r\n    };\r\n}\r\n\r\nexport function fillRequiredBloom(value: Bloom): void {\r\n    if (value.enabled === undefined) {\r\n        value.enabled = false;\r\n    }\r\n    if (value.material === undefined) {\r\n        value.material = null;\r\n    }\r\n    if (value.enableAlphaMask === undefined) {\r\n        value.enableAlphaMask = false;\r\n    }\r\n    if (value.iterations === undefined) {\r\n        value.iterations = 3;\r\n    }\r\n    if (value.threshold === undefined) {\r\n        value.threshold = 0.8;\r\n    }\r\n    if (value.intensity === undefined) {\r\n        value.intensity = 2.3;\r\n    }\r\n}\r\n\r\nexport interface ColorGrading {\r\n    enabled: boolean; /* false */\r\n    /* refcount */ material: Material | null;\r\n    contribute: number; /* 1 */\r\n    /* refcount */ colorGradingMap: Texture2D | null;\r\n    [name: string]: unknown;\r\n}\r\n\r\nexport function makeColorGrading(): ColorGrading {\r\n    return {\r\n        enabled: false,\r\n        material: null,\r\n        contribute: 1,\r\n        colorGradingMap: null,\r\n    };\r\n}\r\n\r\nexport function fillRequiredColorGrading(value: ColorGrading): void {\r\n    if (value.enabled === undefined) {\r\n        value.enabled = false;\r\n    }\r\n    if (value.material === undefined) {\r\n        value.material = null;\r\n    }\r\n    if (value.contribute === undefined) {\r\n        value.contribute = 1;\r\n    }\r\n    if (value.colorGradingMap === undefined) {\r\n        value.colorGradingMap = null;\r\n    }\r\n}\r\n\r\nexport interface FSR {\r\n    enabled: boolean; /* false */\r\n    /* refcount */ material: Material | null;\r\n    sharpness: number; /* 0.8 */\r\n    [name: string]: unknown;\r\n}\r\n\r\nexport function makeFSR(): FSR {\r\n    return {\r\n        enabled: false,\r\n        material: null,\r\n        sharpness: 0.8,\r\n    };\r\n}\r\n\r\nexport function fillRequiredFSR(value: FSR): void {\r\n    if (value.enabled === undefined) {\r\n        value.enabled = false;\r\n    }\r\n    if (value.material === undefined) {\r\n        value.material = null;\r\n    }\r\n    if (value.sharpness === undefined) {\r\n        value.sharpness = 0.8;\r\n    }\r\n}\r\n\r\nexport interface FXAA {\r\n    enabled: boolean; /* false */\r\n    /* refcount */ material: Material | null;\r\n    [name: string]: unknown;\r\n}\r\n\r\nexport function makeFXAA(): FXAA {\r\n    return {\r\n        enabled: false,\r\n        material: null,\r\n    };\r\n}\r\n\r\nexport function fillRequiredFXAA(value: FXAA): void {\r\n    if (value.enabled === undefined) {\r\n        value.enabled = false;\r\n    }\r\n    if (value.material === undefined) {\r\n        value.material = null;\r\n    }\r\n}\r\n\r\nexport interface ToneMapping {\r\n    /* refcount */ material: Material | null;\r\n    [name: string]: unknown;\r\n}\r\n\r\nexport function makeToneMapping(): ToneMapping {\r\n    return {\r\n        material: null,\r\n    };\r\n}\r\n\r\nexport function fillRequiredToneMapping(value: ToneMapping): void {\r\n    if (value.material === undefined) {\r\n        value.material = null;\r\n    }\r\n}\r\n\r\nexport interface PipelineSettings {\r\n    readonly msaa: MSAA;\r\n    enableShadingScale: boolean; /* false */\r\n    shadingScale: number; /* 0.5 */\r\n    readonly depthOfField: DepthOfField;\r\n    readonly bloom: Bloom;\r\n    readonly toneMapping: ToneMapping;\r\n    readonly colorGrading: ColorGrading;\r\n    readonly fsr: FSR;\r\n    readonly fxaa: FXAA;\r\n    [name: string]: unknown;\r\n}\r\n\r\nexport function makePipelineSettings(): PipelineSettings {\r\n    return {\r\n        msaa: makeMSAA(),\r\n        enableShadingScale: false,\r\n        shadingScale: 0.5,\r\n        depthOfField: makeDepthOfField(),\r\n        bloom: makeBloom(),\r\n        toneMapping: makeToneMapping(),\r\n        colorGrading: makeColorGrading(),\r\n        fsr: makeFSR(),\r\n        fxaa: makeFXAA(),\r\n    };\r\n}\r\n\r\nexport function fillRequiredPipelineSettings(value: PipelineSettings): void {\r\n    if (!value.msaa) {\r\n        (value.msaa as MSAA) = makeMSAA();\r\n    } else {\r\n        fillRequiredMSAA(value.msaa);\r\n    }\r\n    if (value.enableShadingScale === undefined) {\r\n        value.enableShadingScale = false;\r\n    }\r\n    if (value.shadingScale === undefined) {\r\n        value.shadingScale = 0.5;\r\n    }\r\n    if (!value.depthOfField) {\r\n        (value.depthOfField as DepthOfField) = makeDepthOfField();\r\n    } else {\r\n        fillRequiredDepthOfField(value.depthOfField);\r\n    }\r\n    if (!value.bloom) {\r\n        (value.bloom as Bloom) = makeBloom();\r\n    } else {\r\n        fillRequiredBloom(value.bloom);\r\n    }\r\n    if (!value.toneMapping) {\r\n        (value.toneMapping as ToneMapping) = makeToneMapping();\r\n    } else {\r\n        fillRequiredToneMapping(value.toneMapping);\r\n    }\r\n    if (!value.colorGrading) {\r\n        (value.colorGrading as ColorGrading) = makeColorGrading();\r\n    } else {\r\n        fillRequiredColorGrading(value.colorGrading);\r\n    }\r\n    if (!value.fsr) {\r\n        (value.fsr as FSR) = makeFSR();\r\n    } else {\r\n        fillRequiredFSR(value.fsr);\r\n    }\r\n    if (!value.fxaa) {\r\n        (value.fxaa as FXAA) = makeFXAA();\r\n    } else {\r\n        fillRequiredFXAA(value.fxaa);\r\n    }\r\n}\r\n","/*\r\n Copyright (c) 2021-2024 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { DEBUG, EDITOR } from 'cc/env';\r\nimport {\r\n    assert,\r\n    clamp,\r\n    geometry,\r\n    gfx,\r\n    Layers,\r\n    Material,\r\n    pipeline,\r\n    renderer,\r\n    rendering,\r\n    sys,\r\n    Vec2,\r\n    Vec3,\r\n    Vec4,\r\n    cclegacy,\r\n    PipelineEventType,\r\n    PipelineEventProcessor,\r\n    ReflectionProbeManager,\r\n    warn,\r\n} from 'cc';\r\n\r\nimport {\r\n    PipelineSettings,\r\n    makePipelineSettings,\r\n} from './builtin-pipeline-types';\r\n\r\nconst { AABB, Sphere, intersect } = geometry;\r\nconst { ClearFlagBit, Color, Format, FormatFeatureBit, LoadOp, StoreOp, TextureType, Viewport } = gfx;\r\nconst { scene } = renderer;\r\nconst { CameraUsage, CSMLevel, LightType } = scene;\r\n\r\nfunction forwardNeedClearColor(camera: renderer.scene.Camera): boolean {\r\n    return !!(camera.clearFlag & (ClearFlagBit.COLOR | (ClearFlagBit.STENCIL << 1)));\r\n}\r\n\r\nfunction getCsmMainLightViewport(\r\n    light: renderer.scene.DirectionalLight,\r\n    w: number,\r\n    h: number,\r\n    level: number,\r\n    vp: gfx.Viewport,\r\n    screenSpaceSignY: number,\r\n): void {\r\n    if (light.shadowFixedArea || light.csmLevel === CSMLevel.LEVEL_1) {\r\n        vp.left = 0;\r\n        vp.top = 0;\r\n        vp.width = Math.trunc(w);\r\n        vp.height = Math.trunc(h);\r\n    } else {\r\n        vp.left = Math.trunc(level % 2 * 0.5 * w);\r\n        if (screenSpaceSignY > 0) {\r\n            vp.top = Math.trunc((1 - Math.floor(level / 2)) * 0.5 * h);\r\n        } else {\r\n            vp.top = Math.trunc(Math.floor(level / 2) * 0.5 * h);\r\n        }\r\n        vp.width = Math.trunc(0.5 * w);\r\n        vp.height = Math.trunc(0.5 * h);\r\n    }\r\n    vp.left = Math.max(0, vp.left);\r\n    vp.top = Math.max(0, vp.top);\r\n    vp.width = Math.max(1, vp.width);\r\n    vp.height = Math.max(1, vp.height);\r\n}\r\n\r\nclass PipelineConfigs {\r\n    isWeb = false;\r\n    isWebGL1 = false;\r\n    isWebGPU = false;\r\n    isMobile = false;\r\n    isHDR = false;\r\n    useFloatOutput = false;\r\n    toneMappingType = 0; // 0: ACES, 1: None\r\n    shadowEnabled = false;\r\n    shadowMapFormat = Format.R32F;\r\n    shadowMapSize = new Vec2(1, 1);\r\n    usePlanarShadow = false;\r\n    screenSpaceSignY = 1;\r\n    supportDepthSample = false;\r\n    mobileMaxSpotLightShadowMaps = 1;\r\n\r\n    platform = new Vec4(0, 0, 0, 0);\r\n}\r\n\r\nfunction setupPipelineConfigs(\r\n    ppl: rendering.BasicPipeline,\r\n    configs: PipelineConfigs,\r\n): void {\r\n    const sampleFeature = FormatFeatureBit.SAMPLED_TEXTURE | FormatFeatureBit.LINEAR_FILTER;\r\n    const device = ppl.device;\r\n    // Platform\r\n    configs.isWeb = !sys.isNative;\r\n    configs.isWebGL1 = device.gfxAPI === gfx.API.WEBGL;\r\n    configs.isWebGPU = device.gfxAPI === gfx.API.WEBGPU;\r\n    configs.isMobile = sys.isMobile;\r\n\r\n    // Rendering\r\n    configs.isHDR = ppl.pipelineSceneData.isHDR; // Has tone mapping\r\n    configs.useFloatOutput = ppl.getMacroBool('CC_USE_FLOAT_OUTPUT');\r\n    configs.toneMappingType = ppl.pipelineSceneData.postSettings.toneMappingType;\r\n    // Shadow\r\n    const shadowInfo = ppl.pipelineSceneData.shadows;\r\n    configs.shadowEnabled = shadowInfo.enabled;\r\n    configs.shadowMapFormat = pipeline.supportsR32FloatTexture(ppl.device) ? Format.R32F : Format.RGBA8;\r\n    configs.shadowMapSize.set(shadowInfo.size);\r\n    configs.usePlanarShadow = shadowInfo.enabled && shadowInfo.type === renderer.scene.ShadowType.Planar;\r\n    // Device\r\n    configs.screenSpaceSignY = ppl.device.capabilities.screenSpaceSignY;\r\n    configs.supportDepthSample = (ppl.device.getFormatFeatures(Format.DEPTH_STENCIL) & sampleFeature) === sampleFeature;\r\n    // Constants\r\n    const screenSpaceSignY = device.capabilities.screenSpaceSignY;\r\n    configs.platform.x = configs.isMobile ? 1.0 : 0.0;\r\n    configs.platform.w = (screenSpaceSignY * 0.5 + 0.5) << 1 | (device.capabilities.clipSpaceSignY * 0.5 + 0.5);\r\n}\r\n\r\nconst defaultSettings = makePipelineSettings();\r\n\r\nclass CameraConfigs {\r\n    colorName = '';\r\n    depthStencilName = '';\r\n    enableMainLightShadowMap = false;\r\n    enableMainLightPlanarShadowMap = false;\r\n    enablePostProcess = false;\r\n    enableProfiler = false;\r\n    enableShadingScale = false;\r\n    enableMSAA = false;\r\n    enableDOF = false;\r\n    enableBloom = false;\r\n    enableColorGrading = false;\r\n    enableFXAA = false;\r\n    enableFSR = false;\r\n    enableHDR = false;\r\n    enablePlanarReflectionProbe = false;\r\n    useFullPipeline = false;\r\n    singleForwardRadiancePass = false;\r\n    radianceFormat = gfx.Format.RGBA8;\r\n    shadingScale = 0.5;\r\n    settings: PipelineSettings = defaultSettings;\r\n}\r\n\r\nfunction setupPostProcessConfigs(\r\n    pipelineConfigs: PipelineConfigs,\r\n    settings: PipelineSettings,\r\n    cameraConfigs: CameraConfigs,\r\n) {\r\n    cameraConfigs.enableDOF = pipelineConfigs.supportDepthSample\r\n        && settings.depthOfField.enabled\r\n        && !!settings.depthOfField.material;\r\n\r\n    cameraConfigs.enableBloom = settings.bloom.enabled\r\n        && !!settings.bloom.material;\r\n\r\n    cameraConfigs.enableColorGrading = settings.colorGrading.enabled\r\n        && !!settings.colorGrading.material\r\n        && !!settings.colorGrading.colorGradingMap;\r\n\r\n    cameraConfigs.enableFXAA = settings.fxaa.enabled\r\n        && !!settings.fxaa.material;\r\n\r\n    cameraConfigs.enablePostProcess = (cameraConfigs.enableDOF\r\n        || cameraConfigs.enableBloom\r\n        || cameraConfigs.enableColorGrading\r\n        || cameraConfigs.enableFXAA);\r\n}\r\n\r\nfunction setupCameraConfigs(\r\n    camera: renderer.scene.Camera,\r\n    pipelineConfigs: PipelineConfigs,\r\n    cameraConfigs: CameraConfigs,\r\n): void {\r\n    const window = camera.window;\r\n    const isMainGameWindow: boolean = camera.cameraUsage === CameraUsage.GAME && !!window.swapchain;\r\n    const isEditorView: boolean = camera.cameraUsage === CameraUsage.SCENE_VIEW || camera.cameraUsage === CameraUsage.PREVIEW;\r\n\r\n    cameraConfigs.colorName = window.colorName;\r\n    cameraConfigs.depthStencilName = window.depthStencilName;\r\n\r\n    cameraConfigs.useFullPipeline = (camera.visibility & (Layers.Enum.DEFAULT)) !== 0;\r\n\r\n    cameraConfigs.enableMainLightShadowMap = pipelineConfigs.shadowEnabled\r\n        && !pipelineConfigs.usePlanarShadow\r\n        && !!camera.scene\r\n        && !!camera.scene.mainLight\r\n        && camera.scene.mainLight.shadowEnabled;\r\n\r\n    cameraConfigs.enableMainLightPlanarShadowMap = pipelineConfigs.shadowEnabled\r\n        && pipelineConfigs.usePlanarShadow\r\n        && !!camera.scene\r\n        && !!camera.scene.mainLight\r\n        && camera.scene.mainLight.shadowEnabled;\r\n\r\n    cameraConfigs.enablePlanarReflectionProbe = isMainGameWindow || camera.cameraUsage === CameraUsage.SCENE_VIEW;\r\n\r\n    cameraConfigs.enableProfiler = DEBUG && isMainGameWindow;\r\n\r\n    cameraConfigs.settings = camera.pipelineSettings\r\n        ? camera.pipelineSettings as PipelineSettings : defaultSettings;\r\n\r\n    setupPostProcessConfigs(pipelineConfigs, cameraConfigs.settings, cameraConfigs);\r\n\r\n    if (isEditorView) {\r\n        const editorSettings = rendering.getEditorPipelineSettings() as PipelineSettings | null;\r\n        if (editorSettings) {\r\n            cameraConfigs.settings = editorSettings;\r\n            setupPostProcessConfigs(pipelineConfigs,\r\n                cameraConfigs.settings, cameraConfigs);\r\n        }\r\n    }\r\n\r\n    // MSAA\r\n    cameraConfigs.enableMSAA = cameraConfigs.settings.msaa.enabled\r\n        && !pipelineConfigs.isWeb // TODO(zhouzhenglong): remove this constraint\r\n        && !pipelineConfigs.isWebGL1;\r\n\r\n    // Shading scale\r\n    cameraConfigs.shadingScale = cameraConfigs.settings.shadingScale;\r\n    cameraConfigs.enableShadingScale = cameraConfigs.settings.enableShadingScale\r\n        && cameraConfigs.shadingScale !== 1.0;\r\n\r\n    // FSR (Depend on Shading scale)\r\n    cameraConfigs.enableFSR = cameraConfigs.settings.fsr.enabled\r\n        && !!cameraConfigs.settings.fsr.material\r\n        && cameraConfigs.enableShadingScale\r\n        && cameraConfigs.shadingScale < 1.0;\r\n\r\n    // Forward rendering (Depend on MSAA and TBR)\r\n    cameraConfigs.singleForwardRadiancePass\r\n        = pipelineConfigs.isMobile || cameraConfigs.enableMSAA;\r\n\r\n    cameraConfigs.enableHDR = cameraConfigs.useFullPipeline\r\n        && pipelineConfigs.useFloatOutput;\r\n\r\n    cameraConfigs.radianceFormat = cameraConfigs.enableHDR\r\n        ? gfx.Format.RGBA16F : gfx.Format.RGBA8;\r\n}\r\n\r\nif (rendering) {\r\n\r\n    const { QueueHint, SceneFlags, ResourceFlags, ResourceResidency } = rendering;\r\n\r\n    class ForwardLighting {\r\n        // Active lights\r\n        private readonly lights: renderer.scene.Light[] = [];\r\n        // Active spot lights with shadows (Mutually exclusive with `lights`)\r\n        private readonly shadowEnabledSpotLights: renderer.scene.SpotLight[] = [];\r\n\r\n        // Internal cached resources\r\n        private readonly _sphere = Sphere.create(0, 0, 0, 1);\r\n        private readonly _boundingBox = new AABB();\r\n        private readonly _rangedDirLightBoundingBox = new AABB(0.0, 0.0, 0.0, 0.5, 0.5, 0.5);\r\n\r\n        // ----------------------------------------------------------------\r\n        // Interface\r\n        // ----------------------------------------------------------------\r\n        public cullLights(scene: renderer.RenderScene, frustum: geometry.Frustum, cameraPos?: Vec3): void {\r\n            // TODO(zhouzhenglong): Make light culling native\r\n            this.lights.length = 0;\r\n            this.shadowEnabledSpotLights.length = 0;\r\n            // spot lights\r\n            for (const light of scene.spotLights) {\r\n                if (light.baked) {\r\n                    continue;\r\n                }\r\n                Sphere.set(this._sphere, light.position.x, light.position.y, light.position.z, light.range);\r\n                if (intersect.sphereFrustum(this._sphere, frustum)) {\r\n                    if (light.shadowEnabled) {\r\n                        this.shadowEnabledSpotLights.push(light);\r\n                    } else {\r\n                        this.lights.push(light);\r\n                    }\r\n                }\r\n            }\r\n            // sphere lights\r\n            for (const light of scene.sphereLights) {\r\n                if (light.baked) {\r\n                    continue;\r\n                }\r\n                Sphere.set(this._sphere, light.position.x, light.position.y, light.position.z, light.range);\r\n                if (intersect.sphereFrustum(this._sphere, frustum)) {\r\n                    this.lights.push(light);\r\n                }\r\n            }\r\n            // point lights\r\n            for (const light of scene.pointLights) {\r\n                if (light.baked) {\r\n                    continue;\r\n                }\r\n                Sphere.set(this._sphere, light.position.x, light.position.y, light.position.z, light.range);\r\n                if (intersect.sphereFrustum(this._sphere, frustum)) {\r\n                    this.lights.push(light);\r\n                }\r\n            }\r\n            // ranged dir lights\r\n            for (const light of scene.rangedDirLights) {\r\n                AABB.transform(this._boundingBox, this._rangedDirLightBoundingBox, light.node!.getWorldMatrix());\r\n                if (intersect.aabbFrustum(this._boundingBox, frustum)) {\r\n                    this.lights.push(light);\r\n                }\r\n            }\r\n\r\n            if (cameraPos) {\r\n                this.shadowEnabledSpotLights.sort(\r\n                    (lhs, rhs) => Vec3.squaredDistance(cameraPos, lhs.position) - Vec3.squaredDistance(cameraPos, rhs.position),\r\n                );\r\n            }\r\n        }\r\n        private _addLightQueues(camera: renderer.scene.Camera, pass: rendering.BasicRenderPassBuilder): void {\r\n            for (const light of this.lights) {\r\n                const queue = pass.addQueue(QueueHint.BLEND, 'forward-add');\r\n                switch (light.type) {\r\n                    case LightType.SPHERE:\r\n                        queue.name = 'sphere-light';\r\n                        break;\r\n                    case LightType.SPOT:\r\n                        queue.name = 'spot-light';\r\n                        break;\r\n                    case LightType.POINT:\r\n                        queue.name = 'point-light';\r\n                        break;\r\n                    case LightType.RANGED_DIRECTIONAL:\r\n                        queue.name = 'ranged-directional-light';\r\n                        break;\r\n                    default:\r\n                        queue.name = 'unknown-light';\r\n                }\r\n                queue.addScene(\r\n                    camera,\r\n                    SceneFlags.BLEND,\r\n                    light,\r\n                );\r\n            }\r\n        }\r\n        public addSpotlightShadowPasses(\r\n            ppl: rendering.BasicPipeline,\r\n            camera: renderer.scene.Camera,\r\n            maxNumShadowMaps: number,\r\n        ): void {\r\n            let i = 0;\r\n            for (const light of this.shadowEnabledSpotLights) {\r\n                const shadowMapSize = ppl.pipelineSceneData.shadows.size;\r\n                const shadowPass = ppl.addRenderPass(shadowMapSize.x, shadowMapSize.y, 'default');\r\n                shadowPass.name = `SpotLightShadowPass${i}`;\r\n                shadowPass.addRenderTarget(`SpotShadowMap${i}`, LoadOp.CLEAR, StoreOp.STORE, new Color(1, 1, 1, 1));\r\n                shadowPass.addDepthStencil(`SpotShadowDepth${i}`, LoadOp.CLEAR, StoreOp.DISCARD);\r\n                shadowPass.addQueue(QueueHint.NONE, 'shadow-caster')\r\n                    .addScene(camera, SceneFlags.OPAQUE | SceneFlags.MASK | SceneFlags.SHADOW_CASTER)\r\n                    .useLightFrustum(light);\r\n                ++i;\r\n                if (i >= maxNumShadowMaps) {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        public addLightQueues(pass: rendering.BasicRenderPassBuilder,\r\n            camera: renderer.scene.Camera, maxNumShadowMaps: number): void {\r\n            this._addLightQueues(camera, pass);\r\n            let i = 0;\r\n            for (const light of this.shadowEnabledSpotLights) {\r\n                // Add spot-light pass\r\n                // Save last RenderPass to the `pass` variable\r\n                // TODO(zhouzhenglong): Fix per queue addTexture\r\n                pass.addTexture(`SpotShadowMap${i}`, 'cc_spotShadowMap');\r\n                const queue = pass.addQueue(QueueHint.BLEND, 'forward-add');\r\n                queue.addScene(camera, SceneFlags.BLEND, light);\r\n                ++i;\r\n                if (i >= maxNumShadowMaps) {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        // Notice: ForwardLighting cannot handle a lot of lights.\r\n        // If there are too many lights, the performance will be very poor.\r\n        // If many lights are needed, please implement a forward+ or deferred rendering pipeline.\r\n        public addLightPasses(\r\n            colorName: string,\r\n            depthStencilName: string,\r\n            depthStencilStoreOp: gfx.StoreOp,\r\n            id: number, // window id\r\n            width: number,\r\n            height: number,\r\n            camera: renderer.scene.Camera,\r\n            viewport: gfx.Viewport,\r\n            ppl: rendering.BasicPipeline,\r\n            pass: rendering.BasicRenderPassBuilder,\r\n        ): rendering.BasicRenderPassBuilder {\r\n            this._addLightQueues(camera, pass);\r\n\r\n            let count = 0;\r\n            const shadowMapSize = ppl.pipelineSceneData.shadows.size;\r\n            for (const light of this.shadowEnabledSpotLights) {\r\n                const shadowPass = ppl.addRenderPass(shadowMapSize.x, shadowMapSize.y, 'default');\r\n                shadowPass.name = 'SpotlightShadowPass';\r\n                // Reuse csm shadow map\r\n                shadowPass.addRenderTarget(`ShadowMap${id}`, LoadOp.CLEAR, StoreOp.STORE, new Color(1, 1, 1, 1));\r\n                shadowPass.addDepthStencil(`ShadowDepth${id}`, LoadOp.CLEAR, StoreOp.DISCARD);\r\n                shadowPass.addQueue(QueueHint.NONE, 'shadow-caster')\r\n                    .addScene(camera, SceneFlags.OPAQUE | SceneFlags.MASK | SceneFlags.SHADOW_CASTER)\r\n                    .useLightFrustum(light);\r\n\r\n                // Add spot-light pass\r\n                // Save last RenderPass to the `pass` variable\r\n                ++count;\r\n                const storeOp = count === this.shadowEnabledSpotLights.length\r\n                    ? depthStencilStoreOp\r\n                    : StoreOp.STORE;\r\n\r\n                pass = ppl.addRenderPass(width, height, 'default');\r\n                pass.name = 'SpotlightWithShadowMap';\r\n                pass.setViewport(viewport);\r\n                pass.addRenderTarget(colorName, LoadOp.LOAD);\r\n                pass.addDepthStencil(depthStencilName, LoadOp.LOAD, storeOp);\r\n                pass.addTexture(`ShadowMap${id}`, 'cc_spotShadowMap');\r\n                const queue = pass.addQueue(QueueHint.BLEND, 'forward-add');\r\n                queue.addScene(\r\n                    camera,\r\n                    SceneFlags.BLEND,\r\n                    light,\r\n                );\r\n            }\r\n            return pass;\r\n        }\r\n\r\n        public isMultipleLightPassesNeeded(): boolean {\r\n            return this.shadowEnabledSpotLights.length > 0;\r\n        }\r\n    }\r\n\r\n    class BuiltinPipelineBuilder implements rendering.PipelineBuilder {\r\n        private readonly _pipelineEvent: PipelineEventProcessor = cclegacy.director.root.pipelineEvent as PipelineEventProcessor;\r\n        // Internal cached resources\r\n        private readonly _clearColor = new Color(0, 0, 0, 1);\r\n        private readonly _clearColorTransparentBlack = new Color(0, 0, 0, 0);\r\n        private readonly _reflectionProbeClearColor = new Vec3(0, 0, 0);\r\n        private readonly _viewport = new Viewport();\r\n        private readonly _configs = new PipelineConfigs();\r\n        private readonly _cameraConfigs = new CameraConfigs();\r\n        // DepthOfField\r\n        private readonly _cocParams = new Vec4(0, 0, 0, 0);\r\n        private readonly _cocTexSize = new Vec4(0, 0, 0, 0);\r\n        // Bloom\r\n        private readonly _bloomParams = new Vec4(0, 0, 0, 0);\r\n        private readonly _bloomTexSize = new Vec4(0, 0, 0, 0);\r\n        private readonly _bloomWidths: Array<number> = [];\r\n        private readonly _bloomHeights: Array<number> = [];\r\n        private readonly _bloomTexNames: Array<string> = [];\r\n        // Color Grading\r\n        private readonly _colorGradingTexSize = new Vec2(0, 0);\r\n        // FXAA\r\n        private readonly _fxaaParams = new Vec4(0, 0, 0, 0);\r\n        // FSR\r\n        private readonly _fsrParams = new Vec4(0, 0, 0, 0);\r\n        private readonly _fsrTexSize = new Vec4(0, 0, 0, 0);\r\n        // Materials\r\n        private readonly _copyAndTonemapMaterial = new Material();\r\n\r\n        // Internal States\r\n        private _initialized = false; // TODO(zhouzhenglong): Make default effect asset loading earlier and remove this flag\r\n\r\n        // Forward lighting\r\n        private readonly forwardLighting = new ForwardLighting();\r\n\r\n        // ----------------------------------------------------------------\r\n        // Interface\r\n        // ----------------------------------------------------------------\r\n        windowResize(\r\n            ppl: rendering.BasicPipeline,\r\n            window: renderer.RenderWindow,\r\n            camera: renderer.scene.Camera,\r\n            nativeWidth: number,\r\n            nativeHeight: number,\r\n        ): void {\r\n            setupPipelineConfigs(ppl, this._configs);\r\n            setupCameraConfigs(camera, this._configs, this._cameraConfigs);\r\n            const settings = this._cameraConfigs.settings;\r\n            const id = window.renderWindowId;\r\n\r\n            const width = this._cameraConfigs.enableShadingScale\r\n                ? Math.max(Math.floor(nativeWidth * this._cameraConfigs.shadingScale), 1)\r\n                : nativeWidth;\r\n            const height = this._cameraConfigs.enableShadingScale\r\n                ? Math.max(Math.floor(nativeHeight * this._cameraConfigs.shadingScale), 1)\r\n                : nativeHeight;\r\n\r\n            // Render Window (UI)\r\n            ppl.addRenderWindow(this._cameraConfigs.colorName,\r\n                Format.RGBA8, nativeWidth, nativeHeight, window,\r\n                this._cameraConfigs.depthStencilName);\r\n\r\n            if (this._cameraConfigs.enableShadingScale) {\r\n                ppl.addDepthStencil(`ScaledSceneDepth${id}`, Format.DEPTH_STENCIL, width, height);\r\n                ppl.addRenderTarget(`ScaledRadiance${id}`, this._cameraConfigs.radianceFormat, width, height);\r\n                ppl.addRenderTarget(`ScaledLdrColor${id}`, Format.RGBA8, width, height);\r\n            } else {\r\n                ppl.addDepthStencil(`SceneDepth${id}`, Format.DEPTH_STENCIL, width, height);\r\n                ppl.addRenderTarget(`Radiance${id}`, this._cameraConfigs.radianceFormat, width, height);\r\n                ppl.addRenderTarget(`LdrColor${id}`, Format.RGBA8, width, height);\r\n            }\r\n\r\n            if (this._cameraConfigs.enableFSR) {\r\n                ppl.addRenderTarget(`FsrColor${id}`, Format.RGBA8, nativeWidth, nativeHeight);\r\n            }\r\n\r\n            // MsaaRadiance\r\n            if (this._cameraConfigs.enableMSAA) {\r\n                // Notice: We never store multisample results.\r\n                // These samples are always resolved and discarded at the end of the render pass.\r\n                // So the ResourceResidency should be MEMORYLESS.\r\n                if (this._cameraConfigs.enableHDR) {\r\n                    ppl.addTexture(`MsaaRadiance${id}`, TextureType.TEX2D, this._cameraConfigs.radianceFormat, width, height, 1, 1, 1,\r\n                        settings.msaa.sampleCount, ResourceFlags.COLOR_ATTACHMENT, ResourceResidency.MEMORYLESS);\r\n                } else {\r\n                    ppl.addTexture(`MsaaRadiance${id}`, TextureType.TEX2D, Format.RGBA8, width, height, 1, 1, 1,\r\n                        settings.msaa.sampleCount, ResourceFlags.COLOR_ATTACHMENT, ResourceResidency.MEMORYLESS);\r\n                }\r\n                ppl.addTexture(`MsaaDepthStencil${id}`, TextureType.TEX2D, Format.DEPTH_STENCIL, width, height, 1, 1, 1,\r\n                    settings.msaa.sampleCount, ResourceFlags.DEPTH_STENCIL_ATTACHMENT, ResourceResidency.MEMORYLESS);\r\n            }\r\n\r\n            // Mainlight ShadowMap\r\n            ppl.addRenderTarget(\r\n                `ShadowMap${id}`,\r\n                this._configs.shadowMapFormat,\r\n                this._configs.shadowMapSize.x,\r\n                this._configs.shadowMapSize.y,\r\n            );\r\n            ppl.addDepthStencil(\r\n                `ShadowDepth${id}`,\r\n                Format.DEPTH_STENCIL,\r\n                this._configs.shadowMapSize.x,\r\n                this._configs.shadowMapSize.y,\r\n            );\r\n\r\n            // Spot-light shadow maps\r\n            if (this._cameraConfigs.singleForwardRadiancePass) {\r\n                const count = this._configs.mobileMaxSpotLightShadowMaps;\r\n                for (let i = 0; i !== count; ++i) {\r\n                    ppl.addRenderTarget(\r\n                        `SpotShadowMap${i}`,\r\n                        this._configs.shadowMapFormat,\r\n                        this._configs.shadowMapSize.x,\r\n                        this._configs.shadowMapSize.y,\r\n                    );\r\n                    ppl.addDepthStencil(\r\n                        `SpotShadowDepth${i}`,\r\n                        Format.DEPTH_STENCIL,\r\n                        this._configs.shadowMapSize.x,\r\n                        this._configs.shadowMapSize.y,\r\n                    );\r\n                }\r\n            }\r\n\r\n            // ---------------------------------------------------------\r\n            // Post Process\r\n            // ---------------------------------------------------------\r\n            // DepthOfField\r\n            if (this._cameraConfigs.enableDOF) {\r\n                const halfWidth = Math.max(Math.floor(width / 2), 1);\r\n                const halfHeight = Math.max(Math.floor(height / 2), 1);\r\n                // `DofCoc${id}` texture will reuse ldrColorName\r\n                ppl.addRenderTarget(`DofRadiance${id}`, this._cameraConfigs.radianceFormat, width, height);\r\n                ppl.addRenderTarget(`DofPrefilter${id}`, this._cameraConfigs.radianceFormat, halfWidth, halfHeight);\r\n                ppl.addRenderTarget(`DofBokeh${id}`, this._cameraConfigs.radianceFormat, halfWidth, halfHeight);\r\n                ppl.addRenderTarget(`DofFilter${id}`, this._cameraConfigs.radianceFormat, halfWidth, halfHeight);\r\n            }\r\n            // Bloom (Kawase Dual Filter)\r\n            if (this._cameraConfigs.enableBloom) {\r\n                let bloomWidth = width;\r\n                let bloomHeight = height;\r\n                for (let i = 0; i !== settings.bloom.iterations + 1; ++i) {\r\n                    bloomWidth = Math.max(Math.floor(bloomWidth / 2), 1);\r\n                    bloomHeight = Math.max(Math.floor(bloomHeight / 2), 1);\r\n                    ppl.addRenderTarget(`BloomTex${id}_${i}`, this._cameraConfigs.radianceFormat, bloomWidth, bloomHeight);\r\n                }\r\n            }\r\n            // Color Grading\r\n            if (this._cameraConfigs.enableColorGrading && settings.colorGrading.material && settings.colorGrading.colorGradingMap) {\r\n                settings.colorGrading.material.setProperty(\r\n                    'colorGradingMap', settings.colorGrading.colorGradingMap);\r\n            }\r\n            // FXAA\r\n            if (this._cameraConfigs.enableFXAA && this._cameraConfigs.enableShadingScale) {\r\n                ppl.addRenderTarget(`AaColor${id}`, Format.RGBA8, width, height);\r\n            }\r\n        }\r\n        setup(cameras: renderer.scene.Camera[], ppl: rendering.BasicPipeline): void {\r\n            // TODO(zhouzhenglong): Make default effect asset loading earlier and remove _initMaterials\r\n            if (this._initMaterials(ppl)) {\r\n                return;\r\n            }\r\n            // Render cameras\r\n            // log(`==================== One Frame ====================`);\r\n            for (const camera of cameras) {\r\n                // Skip invalid camera\r\n                if (!camera.scene || !camera.window) {\r\n                    continue;\r\n                }\r\n                // Setup camera configs\r\n                setupCameraConfigs(camera, this._configs, this._cameraConfigs);\r\n                // log(`Setup camera: ${camera.node!.name}, window: ${camera.window.renderWindowId}, isFull: ${this._cameraConfigs.useFullPipeline}, `\r\n                //     + `size: ${camera.window.width}x${camera.window.height}`);\r\n\r\n                this._pipelineEvent.emit(PipelineEventType.RENDER_CAMERA_BEGIN, camera);\r\n\r\n                // Build pipeline\r\n                if (this._cameraConfigs.useFullPipeline) {\r\n                    this._buildForwardPipeline(ppl, camera, camera.scene);\r\n                } else {\r\n                    this._buildSimplePipeline(ppl, camera);\r\n                }\r\n\r\n                this._pipelineEvent.emit(PipelineEventType.RENDER_CAMERA_END, camera);\r\n            }\r\n        }\r\n\r\n        // ----------------------------------------------------------------\r\n        // Pipelines\r\n        // ----------------------------------------------------------------\r\n        private _buildSimplePipeline(\r\n            ppl: rendering.BasicPipeline,\r\n            camera: renderer.scene.Camera,\r\n        ): void {\r\n            const width = Math.max(Math.floor(camera.window.width), 1);\r\n            const height = Math.max(Math.floor(camera.window.height), 1);\r\n            const colorName = this._cameraConfigs.colorName;\r\n            const depthStencilName = this._cameraConfigs.depthStencilName;\r\n\r\n            const viewport = camera.viewport;  // Reduce C++/TS interop\r\n            this._viewport.left = Math.round(viewport.x * width);\r\n            this._viewport.top = Math.round(viewport.y * height);\r\n            // Here we must use camera.viewport.width instead of camera.viewport.z, which\r\n            // is undefined on native platform. The same as camera.viewport.height.\r\n            this._viewport.width = Math.max(Math.round(viewport.width * width), 1);\r\n            this._viewport.height = Math.max(Math.round(viewport.height * height), 1);\r\n\r\n            const clearColor = camera.clearColor;  // Reduce C++/TS interop\r\n            this._clearColor.x = clearColor.x;\r\n            this._clearColor.y = clearColor.y;\r\n            this._clearColor.z = clearColor.z;\r\n            this._clearColor.w = clearColor.w;\r\n\r\n            const pass = ppl.addRenderPass(width, height, 'default');\r\n\r\n            // bind output render target\r\n            if (forwardNeedClearColor(camera)) {\r\n                pass.addRenderTarget(colorName, LoadOp.CLEAR, StoreOp.STORE, this._clearColor);\r\n            } else {\r\n                pass.addRenderTarget(colorName, LoadOp.LOAD, StoreOp.STORE);\r\n            }\r\n\r\n            // bind depth stencil buffer\r\n            if (camera.clearFlag & ClearFlagBit.DEPTH_STENCIL) {\r\n                pass.addDepthStencil(\r\n                    depthStencilName,\r\n                    LoadOp.CLEAR,\r\n                    StoreOp.DISCARD,\r\n                    camera.clearDepth,\r\n                    camera.clearStencil,\r\n                    camera.clearFlag & ClearFlagBit.DEPTH_STENCIL,\r\n                );\r\n            } else {\r\n                pass.addDepthStencil(depthStencilName, LoadOp.LOAD, StoreOp.DISCARD);\r\n            }\r\n\r\n            pass.setViewport(this._viewport);\r\n\r\n            // The opaque queue is used for Reflection probe preview\r\n            pass.addQueue(QueueHint.OPAQUE)\r\n                .addScene(camera, SceneFlags.OPAQUE);\r\n\r\n            // The blend queue is used for UI and Gizmos\r\n            let flags = SceneFlags.BLEND | SceneFlags.UI;\r\n            if (this._cameraConfigs.enableProfiler) {\r\n                flags |= SceneFlags.PROFILER;\r\n                pass.showStatistics = true;\r\n            }\r\n            pass.addQueue(QueueHint.BLEND)\r\n                .addScene(camera, flags);\r\n        }\r\n\r\n        private _buildForwardPipeline(\r\n            ppl: rendering.BasicPipeline,\r\n            camera: renderer.scene.Camera,\r\n            scene: renderer.RenderScene,\r\n        ): void {\r\n            // Init\r\n            const settings = this._cameraConfigs.settings;\r\n            const nativeWidth = Math.max(Math.floor(camera.window.width), 1);\r\n            const nativeHeight = Math.max(Math.floor(camera.window.height), 1);\r\n            const width = this._cameraConfigs.enableShadingScale\r\n                ? Math.max(Math.floor(nativeWidth * this._cameraConfigs.shadingScale), 1)\r\n                : nativeWidth;\r\n            const height = this._cameraConfigs.enableShadingScale\r\n                ? Math.max(Math.floor(nativeHeight * this._cameraConfigs.shadingScale), 1)\r\n                : nativeHeight;\r\n            const id = camera.window.renderWindowId;\r\n            const colorName = this._cameraConfigs.colorName;\r\n            const sceneDepth = this._cameraConfigs.enableShadingScale\r\n                ? `ScaledSceneDepth${id}`\r\n                : `SceneDepth${id}`;\r\n            const radianceName = this._cameraConfigs.enableShadingScale\r\n                ? `ScaledRadiance${id}`\r\n                : `Radiance${id}`;\r\n            const ldrColorName = this._cameraConfigs.enableShadingScale\r\n                ? `ScaledLdrColor${id}`\r\n                : `LdrColor${id}`;\r\n            const mainLight = scene.mainLight;\r\n\r\n            // Forward Lighting (Light Culling)\r\n            this.forwardLighting.cullLights(scene, camera.frustum);\r\n\r\n            // Main Directional light CSM Shadow Map\r\n            if (this._cameraConfigs.enableMainLightShadowMap) {\r\n                assert(!!mainLight);\r\n                this._addCascadedShadowMapPass(ppl, id, mainLight, camera);\r\n            }\r\n\r\n            // Spot light shadow maps (Mobile or MSAA)\r\n            if (this._cameraConfigs.singleForwardRadiancePass) {\r\n                // Currently, only support 1 spot light with shadow map on mobile platform.\r\n                // TODO(zhouzhenglong): Relex this limitation.\r\n                this.forwardLighting.addSpotlightShadowPasses(ppl, camera, this._configs.mobileMaxSpotLightShadowMaps);\r\n            }\r\n\r\n            this._tryAddReflectionProbePasses(ppl, id, mainLight, camera.scene);\r\n\r\n            // Forward Lighting\r\n            let lastPass: rendering.BasicRenderPassBuilder;\r\n            if (this._cameraConfigs.enablePostProcess) { // Post Process\r\n                // Radiance and DoF\r\n                if (this._cameraConfigs.enableDOF) {\r\n                    assert(!!settings.depthOfField.material);\r\n                    const dofRadianceName = `DofRadiance${id}`;\r\n                    // Disable MSAA, depth stencil cannot be resolved cross-platformly\r\n                    this._addForwardRadiancePasses(ppl, id, camera, width, height, mainLight,\r\n                        dofRadianceName, sceneDepth, true, StoreOp.STORE);\r\n                    this._addDepthOfFieldPasses(ppl, settings, settings.depthOfField.material,\r\n                        id, camera, width, height,\r\n                        dofRadianceName, sceneDepth, radianceName, ldrColorName);\r\n                } else {\r\n                    this._addForwardRadiancePasses(\r\n                        ppl, id, camera, width, height, mainLight,\r\n                        radianceName, sceneDepth);\r\n                }\r\n                // Bloom\r\n                if (this._cameraConfigs.enableBloom) {\r\n                    assert(!!settings.bloom.material);\r\n                    this._addKawaseDualFilterBloomPasses(\r\n                        ppl, settings, settings.bloom.material,\r\n                        id, width, height, radianceName);\r\n                }\r\n                // Tone Mapping and FXAA\r\n                if (this._cameraConfigs.enableFXAA) {\r\n                    assert(!!settings.fxaa.material);\r\n                    const copyAndTonemapPassNeeded = this._cameraConfigs.enableHDR\r\n                        || this._cameraConfigs.enableColorGrading;\r\n                    const ldrColorBufferName = copyAndTonemapPassNeeded ? ldrColorName : radianceName;\r\n                    // FXAA is applied after tone mapping\r\n                    if (copyAndTonemapPassNeeded) {\r\n                        this._addCopyAndTonemapPass(ppl, settings, width, height, radianceName, ldrColorBufferName);\r\n                    }\r\n                    // Apply FXAA\r\n                    if (this._cameraConfigs.enableShadingScale) {\r\n                        const aaColorName = `AaColor${id}`;\r\n                        // Apply FXAA on scaled image\r\n                        this._addFxaaPass(ppl, settings.fxaa.material,\r\n                            width, height, ldrColorBufferName, aaColorName);\r\n                        // Copy FXAA result to screen\r\n                        if (this._cameraConfigs.enableFSR && settings.fsr.material) {\r\n                            // Apply FSR\r\n                            lastPass = this._addFsrPass(ppl, settings, settings.fsr.material,\r\n                                id, width, height, aaColorName,\r\n                                nativeWidth, nativeHeight, colorName);\r\n                        } else {\r\n                            // Scale FXAA result to screen\r\n                            lastPass = this._addCopyPass(ppl,\r\n                                nativeWidth, nativeHeight, aaColorName, colorName);\r\n                        }\r\n                    } else {\r\n                        // Image not scaled, output FXAA result to screen directly\r\n                        lastPass = this._addFxaaPass(ppl, settings.fxaa.material,\r\n                            nativeWidth, nativeHeight, ldrColorBufferName, colorName);\r\n                    }\r\n                } else {\r\n                    // No FXAA (Size might be scaled)\r\n                    lastPass = this._addTonemapResizeOrSuperResolutionPasses(ppl, settings, id,\r\n                        width, height, radianceName, ldrColorName,\r\n                        nativeWidth, nativeHeight, colorName);\r\n                }\r\n            } else if (this._cameraConfigs.enableHDR || this._cameraConfigs.enableShadingScale) { // HDR or Scaled LDR\r\n                this._addForwardRadiancePasses(ppl, id, camera,\r\n                    width, height, mainLight, radianceName, sceneDepth);\r\n                lastPass = this._addTonemapResizeOrSuperResolutionPasses(ppl, settings, id,\r\n                    width, height, radianceName, ldrColorName,\r\n                    nativeWidth, nativeHeight, colorName);\r\n            } else { // LDR (Size is not scaled)\r\n                lastPass = this._addForwardRadiancePasses(ppl, id, camera,\r\n                    nativeWidth, nativeHeight, mainLight,\r\n                    colorName, this._cameraConfigs.depthStencilName);\r\n            }\r\n\r\n            // UI size is not scaled, does not have AA\r\n            this._addUIQueue(camera, lastPass);\r\n        }\r\n\r\n        // ----------------------------------------------------------------\r\n        // Common Passes\r\n        // ----------------------------------------------------------------\r\n        private _addTonemapResizeOrSuperResolutionPasses(\r\n            ppl: rendering.BasicPipeline,\r\n            settings: PipelineSettings,\r\n            id: number,\r\n            width: number,\r\n            height: number,\r\n            radianceName: string,\r\n            ldrColorName: string,\r\n            nativeWidth: number,\r\n            nativeHeight: number,\r\n            colorName: string,\r\n        ): rendering.BasicRenderPassBuilder {\r\n            let lastPass: rendering.BasicRenderPassBuilder;\r\n            if (this._cameraConfigs.enableFSR && settings.fsr.material) {\r\n                // Apply FSR\r\n                this._addCopyAndTonemapPass(ppl, settings,\r\n                    width, height, radianceName, ldrColorName);\r\n                lastPass = this._addFsrPass(ppl, settings,\r\n                    settings.fsr.material,\r\n                    id, width, height, ldrColorName,\r\n                    nativeWidth, nativeHeight, colorName);\r\n            } else {\r\n                // Output HDR/LDR result to screen directly (Size might be scaled)\r\n                lastPass = this._addCopyAndTonemapPass(ppl, settings,\r\n                    nativeWidth, nativeHeight, radianceName, colorName);\r\n            }\r\n            return lastPass;\r\n        }\r\n\r\n        private _addCascadedShadowMapPass(\r\n            ppl: rendering.BasicPipeline,\r\n            id: number,\r\n            light: renderer.scene.DirectionalLight,\r\n            camera: renderer.scene.Camera,\r\n        ): void {\r\n            // ----------------------------------------------------------------\r\n            // Dynamic states\r\n            // ----------------------------------------------------------------\r\n            const width = ppl.pipelineSceneData.shadows.size.x;\r\n            const height = ppl.pipelineSceneData.shadows.size.y;\r\n            this._viewport.left = 0;\r\n            this._viewport.top = 0;\r\n            this._viewport.width = width;\r\n            this._viewport.height = height;\r\n\r\n            // ----------------------------------------------------------------\r\n            // CSM Shadow Map\r\n            // ----------------------------------------------------------------\r\n            const pass = ppl.addRenderPass(width, height, 'default');\r\n            pass.name = 'CascadedShadowMap';\r\n            pass.addRenderTarget(`ShadowMap${id}`, LoadOp.CLEAR, StoreOp.STORE, new Color(1, 1, 1, 1));\r\n            pass.addDepthStencil(`ShadowDepth${id}`, LoadOp.CLEAR, StoreOp.DISCARD);\r\n            const csmLevel = ppl.pipelineSceneData.csmSupported ? light.csmLevel : 1;\r\n\r\n            // Add shadow map viewports\r\n            for (let level = 0; level !== csmLevel; ++level) {\r\n                getCsmMainLightViewport(light, width, height, level, this._viewport, this._configs.screenSpaceSignY);\r\n                const queue = pass.addQueue(QueueHint.NONE, 'shadow-caster');\r\n                if (!this._configs.isWebGPU) { // Temporary workaround for WebGPU\r\n                    queue.setViewport(this._viewport);\r\n                }\r\n                queue\r\n                    .addScene(camera, SceneFlags.OPAQUE | SceneFlags.MASK | SceneFlags.SHADOW_CASTER)\r\n                    .useLightFrustum(light, level);\r\n            }\r\n        }\r\n\r\n        private _addCopyPass(\r\n            ppl: rendering.BasicPipeline,\r\n            width: number,\r\n            height: number,\r\n            input: string,\r\n            output: string,\r\n        ): rendering.BasicRenderPassBuilder {\r\n            const pass = ppl.addRenderPass(width, height, 'cc-tone-mapping');\r\n            pass.addRenderTarget(output, LoadOp.CLEAR, StoreOp.STORE, this._clearColorTransparentBlack);\r\n            pass.addTexture(input, 'inputTexture');\r\n            pass.setVec4('g_platform', this._configs.platform);\r\n            pass.addQueue(QueueHint.OPAQUE)\r\n                .addFullscreenQuad(this._copyAndTonemapMaterial, 1);\r\n            return pass;\r\n        }\r\n\r\n        private _addCopyAndTonemapPass(\r\n            ppl: rendering.BasicPipeline,\r\n            settings: PipelineSettings,\r\n            width: number,\r\n            height: number,\r\n            radianceName: string,\r\n            colorName: string,\r\n        ): rendering.BasicRenderPassBuilder {\r\n            let pass: rendering.BasicRenderPassBuilder;\r\n            if (this._cameraConfigs.enableColorGrading\r\n                && settings.colorGrading.material\r\n                && settings.colorGrading.colorGradingMap) {\r\n                const lutTex = settings.colorGrading.colorGradingMap;\r\n                this._colorGradingTexSize.x = lutTex.width;\r\n                this._colorGradingTexSize.y = lutTex.height;\r\n\r\n                const isSquareMap = lutTex.width === lutTex.height;\r\n                if (isSquareMap) {\r\n                    pass = ppl.addRenderPass(width, height, 'cc-color-grading-8x8');\r\n                } else {\r\n                    pass = ppl.addRenderPass(width, height, 'cc-color-grading-nx1');\r\n                }\r\n                pass.addRenderTarget(colorName, LoadOp.CLEAR, StoreOp.STORE, this._clearColorTransparentBlack);\r\n                pass.addTexture(radianceName, 'sceneColorMap');\r\n                pass.setVec4('g_platform', this._configs.platform);\r\n                pass.setVec2('lutTextureSize', this._colorGradingTexSize);\r\n                pass.setFloat('contribute', settings.colorGrading.contribute);\r\n                pass.addQueue(QueueHint.OPAQUE)\r\n                    .addFullscreenQuad(settings.colorGrading.material, isSquareMap ? 1 : 0);\r\n            } else {\r\n                pass = ppl.addRenderPass(width, height, 'cc-tone-mapping');\r\n                pass.addRenderTarget(colorName, LoadOp.CLEAR, StoreOp.STORE, this._clearColorTransparentBlack);\r\n                pass.addTexture(radianceName, 'inputTexture');\r\n                pass.setVec4('g_platform', this._configs.platform);\r\n                if (settings.toneMapping.material) {\r\n                    pass.addQueue(QueueHint.OPAQUE)\r\n                        .addFullscreenQuad(settings.toneMapping.material, 0);\r\n                } else {\r\n                    pass.addQueue(QueueHint.OPAQUE)\r\n                        .addFullscreenQuad(this._copyAndTonemapMaterial, 0);\r\n                }\r\n            }\r\n            return pass;\r\n        }\r\n\r\n        private _buildForwardMainLightPass(\r\n            pass: rendering.BasicRenderPassBuilder,\r\n            id: number,\r\n            camera: renderer.scene.Camera,\r\n            colorName: string,\r\n            depthStencilName: string,\r\n            depthStencilStoreOp: gfx.StoreOp,\r\n            mainLight: renderer.scene.DirectionalLight | null,\r\n            scene: renderer.RenderScene | null = null,\r\n        ): void {\r\n            // set viewport\r\n            pass.setViewport(this._viewport);\r\n\r\n            const colorStoreOp = this._cameraConfigs.enableMSAA ? StoreOp.DISCARD : StoreOp.STORE;\r\n\r\n            // bind output render target\r\n            if (forwardNeedClearColor(camera)) {\r\n                pass.addRenderTarget(colorName, LoadOp.CLEAR, colorStoreOp, this._clearColor);\r\n            } else {\r\n                pass.addRenderTarget(colorName, LoadOp.LOAD, colorStoreOp);\r\n            }\r\n\r\n            // bind depth stencil buffer\r\n            if (DEBUG) {\r\n                if (colorName === this._cameraConfigs.colorName &&\r\n                    depthStencilName !== this._cameraConfigs.depthStencilName) {\r\n                    warn('Default framebuffer cannot use custom depth stencil buffer');\r\n                }\r\n            }\r\n\r\n            if (camera.clearFlag & ClearFlagBit.DEPTH_STENCIL) {\r\n                pass.addDepthStencil(\r\n                    depthStencilName,\r\n                    LoadOp.CLEAR,\r\n                    depthStencilStoreOp,\r\n                    camera.clearDepth,\r\n                    camera.clearStencil,\r\n                    camera.clearFlag & ClearFlagBit.DEPTH_STENCIL,\r\n                );\r\n            } else {\r\n                pass.addDepthStencil(depthStencilName, LoadOp.LOAD, depthStencilStoreOp);\r\n            }\r\n\r\n            // Set shadow map if enabled\r\n            if (this._cameraConfigs.enableMainLightShadowMap) {\r\n                pass.addTexture(`ShadowMap${id}`, 'cc_shadowMap');\r\n            }\r\n\r\n            // TODO(zhouzhenglong): Separate OPAQUE and MASK queue\r\n\r\n            // add opaque and mask queue\r\n            pass.addQueue(QueueHint.NONE) // Currently we put OPAQUE and MASK into one queue, so QueueHint is NONE\r\n                .addScene(camera,\r\n                    SceneFlags.OPAQUE | SceneFlags.MASK,\r\n                    mainLight || undefined,\r\n                    scene ? scene : undefined);\r\n        }\r\n\r\n        private _addDepthOfFieldPasses(\r\n            ppl: rendering.BasicPipeline,\r\n            settings: PipelineSettings,\r\n            dofMaterial: Material,\r\n            id: number,\r\n            camera: renderer.scene.Camera,\r\n            width: number,\r\n            height: number,\r\n            dofRadianceName: string,\r\n            depthStencil: string,\r\n            radianceName: string,\r\n            ldrColorName: string,\r\n        ): void {\r\n            // https://catlikecoding.com/unity/tutorials/advanced-rendering/depth-of-field/\r\n\r\n            this._cocParams.x = settings.depthOfField.focusDistance;\r\n            this._cocParams.y = settings.depthOfField.focusRange;\r\n            this._cocParams.z = settings.depthOfField.bokehRadius;\r\n            this._cocParams.w = 0.0;\r\n            this._cocTexSize.x = 1.0 / width;\r\n            this._cocTexSize.y = 1.0 / height;\r\n            this._cocTexSize.z = width;\r\n            this._cocTexSize.w = height;\r\n\r\n            const halfWidth = Math.max(Math.floor(width / 2), 1);\r\n            const halfHeight = Math.max(Math.floor(height / 2), 1);\r\n\r\n            const cocName = ldrColorName;\r\n            const prefilterName = `DofPrefilter${id}`;\r\n            const bokehName = `DofBokeh${id}`;\r\n            const filterName = `DofFilter${id}`;\r\n\r\n            // CoC\r\n            const cocPass = ppl.addRenderPass(width, height, 'cc-dof-coc');\r\n            cocPass.addRenderTarget(cocName, LoadOp.CLEAR, StoreOp.STORE, this._clearColorTransparentBlack);\r\n            cocPass.addTexture(depthStencil, 'DepthTex');\r\n            cocPass.setVec4('g_platform', this._configs.platform);\r\n            cocPass.setMat4('proj', camera.matProj);\r\n            cocPass.setVec4('cocParams', this._cocParams);\r\n            cocPass\r\n                .addQueue(QueueHint.OPAQUE)\r\n                .addCameraQuad(camera, dofMaterial, 0); // addCameraQuad will set camera related UBOs\r\n\r\n            // Downsample and Prefilter\r\n            const prefilterPass = ppl.addRenderPass(halfWidth, halfHeight, 'cc-dof-prefilter');\r\n            prefilterPass.addRenderTarget(prefilterName, LoadOp.CLEAR, StoreOp.STORE, this._clearColorTransparentBlack);\r\n            prefilterPass.addTexture(dofRadianceName, 'colorTex');\r\n            prefilterPass.addTexture(cocName, 'cocTex');\r\n            prefilterPass.setVec4('g_platform', this._configs.platform);\r\n            prefilterPass.setVec4('mainTexTexelSize', this._cocTexSize);\r\n            prefilterPass\r\n                .addQueue(QueueHint.OPAQUE)\r\n                .addFullscreenQuad(dofMaterial, 1);\r\n\r\n            // Bokeh blur\r\n            const bokehPass = ppl.addRenderPass(halfWidth, halfHeight, 'cc-dof-bokeh');\r\n            bokehPass.addRenderTarget(bokehName, LoadOp.CLEAR, StoreOp.STORE, this._clearColorTransparentBlack);\r\n            bokehPass.addTexture(prefilterName, 'prefilterTex');\r\n            bokehPass.setVec4('g_platform', this._configs.platform);\r\n            bokehPass.setVec4('mainTexTexelSize', this._cocTexSize);\r\n            bokehPass.setVec4('cocParams', this._cocParams);\r\n            bokehPass\r\n                .addQueue(QueueHint.OPAQUE)\r\n                .addFullscreenQuad(dofMaterial, 2);\r\n\r\n            // Filtering\r\n            const filterPass = ppl.addRenderPass(halfWidth, halfHeight, 'cc-dof-filter');\r\n            filterPass.addRenderTarget(filterName, LoadOp.CLEAR, StoreOp.STORE, this._clearColorTransparentBlack);\r\n            filterPass.addTexture(bokehName, 'bokehTex');\r\n            filterPass.setVec4('g_platform', this._configs.platform);\r\n            filterPass.setVec4('mainTexTexelSize', this._cocTexSize);\r\n            filterPass\r\n                .addQueue(QueueHint.OPAQUE)\r\n                .addFullscreenQuad(dofMaterial, 3);\r\n\r\n            // Combine\r\n            const combinePass = ppl.addRenderPass(width, height, 'cc-dof-combine');\r\n            combinePass.addRenderTarget(radianceName, LoadOp.CLEAR, StoreOp.STORE, this._clearColorTransparentBlack);\r\n            combinePass.addTexture(dofRadianceName, 'colorTex');\r\n            combinePass.addTexture(cocName, 'cocTex');\r\n            combinePass.addTexture(filterName, 'filterTex');\r\n            combinePass.setVec4('g_platform', this._configs.platform);\r\n            combinePass.setVec4('cocParams', this._cocParams);\r\n            combinePass\r\n                .addQueue(QueueHint.OPAQUE)\r\n                .addFullscreenQuad(dofMaterial, 4);\r\n        }\r\n\r\n        private _addKawaseDualFilterBloomPasses(\r\n            ppl: rendering.BasicPipeline,\r\n            settings: PipelineSettings,\r\n            bloomMaterial: Material,\r\n            id: number,\r\n            width: number,\r\n            height: number,\r\n            radianceName: string,\r\n        ): void {\r\n            // Based on Kawase Dual Filter Blur. Saves bandwidth on mobile devices.\r\n            // eslint-disable-next-line max-len\r\n            // https://community.arm.com/cfs-file/__key/communityserver-blogs-components-weblogfiles/00-00-00-20-66/siggraph2015_2D00_mmg_2D00_marius_2D00_slides.pdf\r\n\r\n            // Size: [prefilter(1/2), downsample(1/4), downsample(1/8), downsample(1/16), ...]\r\n            const iterations = settings.bloom.iterations;\r\n            const sizeCount = iterations + 1;\r\n            this._bloomWidths.length = sizeCount;\r\n            this._bloomHeights.length = sizeCount;\r\n            this._bloomWidths[0] = Math.max(Math.floor(width / 2), 1);\r\n            this._bloomHeights[0] = Math.max(Math.floor(height / 2), 1);\r\n            for (let i = 1; i !== sizeCount; ++i) {\r\n                this._bloomWidths[i] = Math.max(Math.floor(this._bloomWidths[i - 1] / 2), 1);\r\n                this._bloomHeights[i] = Math.max(Math.floor(this._bloomHeights[i - 1] / 2), 1);\r\n            }\r\n\r\n            // Bloom texture names\r\n            this._bloomTexNames.length = sizeCount;\r\n            for (let i = 0; i !== sizeCount; ++i) {\r\n                this._bloomTexNames[i] = `BloomTex${id}_${i}`;\r\n            }\r\n\r\n            // Setup bloom parameters\r\n            this._bloomParams.x = this._configs.useFloatOutput ? 1 : 0;\r\n            this._bloomParams.x = 0; // unused\r\n            this._bloomParams.z = settings.bloom.threshold;\r\n            this._bloomParams.w = settings.bloom.enableAlphaMask ? 1 : 0;\r\n\r\n            // Prefilter pass\r\n            const prefilterPass = ppl.addRenderPass(this._bloomWidths[0], this._bloomHeights[0], 'cc-bloom-prefilter');\r\n            prefilterPass.addRenderTarget(\r\n                this._bloomTexNames[0],\r\n                LoadOp.CLEAR,\r\n                StoreOp.STORE,\r\n                this._clearColorTransparentBlack,\r\n            );\r\n            prefilterPass.addTexture(radianceName, 'inputTexture');\r\n            prefilterPass.setVec4('g_platform', this._configs.platform);\r\n            prefilterPass.setVec4('bloomParams', this._bloomParams);\r\n            prefilterPass\r\n                .addQueue(QueueHint.OPAQUE)\r\n                .addFullscreenQuad(bloomMaterial, 0);\r\n\r\n            // Downsample passes\r\n            for (let i = 1; i !== sizeCount; ++i) {\r\n                const downPass = ppl.addRenderPass(this._bloomWidths[i], this._bloomHeights[i], 'cc-bloom-downsample');\r\n                downPass.addRenderTarget(this._bloomTexNames[i], LoadOp.CLEAR, StoreOp.STORE, this._clearColorTransparentBlack);\r\n                downPass.addTexture(this._bloomTexNames[i - 1], 'bloomTexture');\r\n                this._bloomTexSize.x = this._bloomWidths[i - 1];\r\n                this._bloomTexSize.y = this._bloomHeights[i - 1];\r\n                downPass.setVec4('g_platform', this._configs.platform);\r\n                downPass.setVec4('bloomTexSize', this._bloomTexSize);\r\n                downPass\r\n                    .addQueue(QueueHint.OPAQUE)\r\n                    .addFullscreenQuad(bloomMaterial, 1);\r\n            }\r\n\r\n            // Upsample passes\r\n            for (let i = iterations; i-- > 0;) {\r\n                const upPass = ppl.addRenderPass(this._bloomWidths[i], this._bloomHeights[i], 'cc-bloom-upsample');\r\n                upPass.addRenderTarget(this._bloomTexNames[i], LoadOp.CLEAR, StoreOp.STORE, this._clearColorTransparentBlack);\r\n                upPass.addTexture(this._bloomTexNames[i + 1], 'bloomTexture');\r\n                this._bloomTexSize.x = this._bloomWidths[i + 1];\r\n                this._bloomTexSize.y = this._bloomHeights[i + 1];\r\n                upPass.setVec4('g_platform', this._configs.platform);\r\n                upPass.setVec4('bloomTexSize', this._bloomTexSize);\r\n                upPass\r\n                    .addQueue(QueueHint.OPAQUE)\r\n                    .addFullscreenQuad(bloomMaterial, 2);\r\n            }\r\n\r\n            // Combine pass\r\n            const combinePass = ppl.addRenderPass(width, height, 'cc-bloom-combine');\r\n            combinePass.addRenderTarget(radianceName, LoadOp.LOAD, StoreOp.STORE);\r\n            combinePass.addTexture(this._bloomTexNames[0], 'bloomTexture');\r\n            combinePass.setVec4('g_platform', this._configs.platform);\r\n            combinePass.setVec4('bloomParams', this._bloomParams);\r\n            combinePass\r\n                .addQueue(QueueHint.BLEND)\r\n                .addFullscreenQuad(bloomMaterial, 3);\r\n        }\r\n\r\n        private _addFsrPass(\r\n            ppl: rendering.BasicPipeline,\r\n            settings: PipelineSettings,\r\n            fsrMaterial: Material,\r\n            id: number,\r\n            width: number,\r\n            height: number,\r\n            ldrColorName: string,\r\n            nativeWidth: number,\r\n            nativeHeight: number,\r\n            colorName: string,\r\n        ): rendering.BasicRenderPassBuilder {\r\n            this._fsrTexSize.x = width;\r\n            this._fsrTexSize.y = height;\r\n            this._fsrTexSize.z = nativeWidth;\r\n            this._fsrTexSize.w = nativeHeight;\r\n            this._fsrParams.x = clamp(1.0 - settings.fsr.sharpness, 0.02, 0.98);\r\n\r\n            const fsrColorName = `FsrColor${id}`;\r\n\r\n            const easuPass = ppl.addRenderPass(nativeWidth, nativeHeight, 'cc-fsr-easu');\r\n            easuPass.addRenderTarget(fsrColorName, LoadOp.CLEAR, StoreOp.STORE, this._clearColorTransparentBlack);\r\n            easuPass.addTexture(ldrColorName, 'outputResultMap');\r\n            easuPass.setVec4('g_platform', this._configs.platform);\r\n            easuPass.setVec4('fsrTexSize', this._fsrTexSize);\r\n            easuPass\r\n                .addQueue(QueueHint.OPAQUE)\r\n                .addFullscreenQuad(fsrMaterial, 0);\r\n\r\n            const rcasPass = ppl.addRenderPass(nativeWidth, nativeHeight, 'cc-fsr-rcas');\r\n            rcasPass.addRenderTarget(colorName, LoadOp.CLEAR, StoreOp.STORE, this._clearColorTransparentBlack);\r\n            rcasPass.addTexture(fsrColorName, 'outputResultMap');\r\n            rcasPass.setVec4('g_platform', this._configs.platform);\r\n            rcasPass.setVec4('fsrTexSize', this._fsrTexSize);\r\n            rcasPass.setVec4('fsrParams', this._fsrParams);\r\n            rcasPass\r\n                .addQueue(QueueHint.OPAQUE)\r\n                .addFullscreenQuad(fsrMaterial, 1);\r\n\r\n            return rcasPass;\r\n        }\r\n\r\n        private _addFxaaPass(\r\n            ppl: rendering.BasicPipeline,\r\n            fxaaMaterial: Material,\r\n            width: number,\r\n            height: number,\r\n            ldrColorName: string,\r\n            colorName: string,\r\n        ): rendering.BasicRenderPassBuilder {\r\n            this._fxaaParams.x = width;\r\n            this._fxaaParams.y = height;\r\n            this._fxaaParams.z = 1 / width;\r\n            this._fxaaParams.w = 1 / height;\r\n            const pass = ppl.addRenderPass(width, height, 'cc-fxaa');\r\n            pass.addRenderTarget(colorName, LoadOp.CLEAR, StoreOp.STORE, this._clearColorTransparentBlack);\r\n            pass.addTexture(ldrColorName, 'sceneColorMap');\r\n            pass.setVec4('g_platform', this._configs.platform);\r\n            pass.setVec4('texSize', this._fxaaParams);\r\n            pass.addQueue(QueueHint.OPAQUE)\r\n                .addFullscreenQuad(fxaaMaterial, 0);\r\n            return pass;\r\n        }\r\n\r\n        private _addUIQueue(camera: renderer.scene.Camera, pass: rendering.BasicRenderPassBuilder): void {\r\n            let flags = SceneFlags.UI;\r\n            if (this._cameraConfigs.enableProfiler) {\r\n                flags |= SceneFlags.PROFILER;\r\n                pass.showStatistics = true;\r\n            }\r\n            pass\r\n                .addQueue(QueueHint.BLEND, 'default', 'default')\r\n                .addScene(camera, flags);\r\n        }\r\n\r\n        // ----------------------------------------------------------------\r\n        // Forward\r\n        // ----------------------------------------------------------------\r\n        private _addForwardRadiancePasses(\r\n            ppl: rendering.BasicPipeline,\r\n            id: number,\r\n            camera: renderer.scene.Camera,\r\n            width: number,\r\n            height: number,\r\n            mainLight: renderer.scene.DirectionalLight | null,\r\n            colorName: string,\r\n            depthStencilName: string,\r\n            disableMSAA: boolean = false,\r\n            depthStencilStoreOp: gfx.StoreOp = StoreOp.DISCARD,\r\n        ): rendering.BasicRenderPassBuilder {\r\n            // ----------------------------------------------------------------\r\n            // Dynamic states\r\n            // ----------------------------------------------------------------\r\n            // Prepare camera clear color\r\n            const clearColor = camera.clearColor; // Reduce C++/TS interop\r\n            this._clearColor.x = clearColor.x;\r\n            this._clearColor.y = clearColor.y;\r\n            this._clearColor.z = clearColor.z;\r\n            this._clearColor.w = clearColor.w;\r\n\r\n            // Prepare camera viewport\r\n            const viewport = camera.viewport; // Reduce C++/TS interop\r\n            this._viewport.left = Math.round(viewport.x * width);\r\n            this._viewport.top = Math.round(viewport.y * height);\r\n            // Here we must use camera.viewport.width instead of camera.viewport.z, which\r\n            // is undefined on native platform. The same as camera.viewport.height.\r\n            this._viewport.width = Math.max(Math.round(viewport.width * width), 1);\r\n            this._viewport.height = Math.max(Math.round(viewport.height * height), 1);\r\n\r\n            // MSAA\r\n            const enableMSAA = !disableMSAA && this._cameraConfigs.enableMSAA;\r\n            assert(!enableMSAA || this._cameraConfigs.singleForwardRadiancePass);\r\n\r\n            // ----------------------------------------------------------------\r\n            // Forward Lighting (Main Directional Light)\r\n            // ----------------------------------------------------------------\r\n            const pass = this._cameraConfigs.singleForwardRadiancePass\r\n                ? this._addForwardSingleRadiancePass(ppl, id, camera, enableMSAA, width, height, mainLight,\r\n                    colorName, depthStencilName, depthStencilStoreOp)\r\n                : this._addForwardMultipleRadiancePasses(ppl, id, camera, width, height, mainLight,\r\n                    colorName, depthStencilName, depthStencilStoreOp);\r\n\r\n            // Planar Shadow\r\n            if (this._cameraConfigs.enableMainLightPlanarShadowMap) {\r\n                this.addPlanarShadowQueue(camera, mainLight, pass);\r\n            }\r\n\r\n            // ----------------------------------------------------------------\r\n            // Forward Lighting (Blend)\r\n            // ----------------------------------------------------------------\r\n            // Add transparent queue\r\n\r\n            const sceneFlags = SceneFlags.BLEND |\r\n                (camera.geometryRenderer\r\n                    ? SceneFlags.GEOMETRY\r\n                    : SceneFlags.NONE);\r\n\r\n            pass\r\n                .addQueue(QueueHint.BLEND)\r\n                .addScene(camera, sceneFlags, mainLight || undefined);\r\n\r\n            return pass;\r\n        }\r\n\r\n        private _addForwardSingleRadiancePass(\r\n            ppl: rendering.BasicPipeline,\r\n            id: number,\r\n            camera: renderer.scene.Camera,\r\n            enableMSAA: boolean,\r\n            width: number,\r\n            height: number,\r\n            mainLight: renderer.scene.DirectionalLight | null,\r\n            colorName: string,\r\n            depthStencilName: string,\r\n            depthStencilStoreOp: gfx.StoreOp\r\n        ): rendering.BasicRenderPassBuilder {\r\n            assert(this._cameraConfigs.singleForwardRadiancePass);\r\n            // ----------------------------------------------------------------\r\n            // Forward Lighting (Main Directional Light)\r\n            // ----------------------------------------------------------------\r\n            let pass: rendering.BasicRenderPassBuilder;\r\n            if (enableMSAA) {\r\n                const msaaRadianceName = `MsaaRadiance${id}`;\r\n                const msaaDepthStencilName = `MsaaDepthStencil${id}`;\r\n                const sampleCount = this._cameraConfigs.settings.msaa.sampleCount;\r\n\r\n                const msPass = ppl.addMultisampleRenderPass(width, height, sampleCount, 0, 'default');\r\n                msPass.name = 'MsaaForwardPass';\r\n\r\n                // MSAA always discards depth stencil\r\n                this._buildForwardMainLightPass(msPass, id, camera,\r\n                    msaaRadianceName, msaaDepthStencilName, StoreOp.DISCARD, mainLight);\r\n\r\n                msPass.resolveRenderTarget(msaaRadianceName, colorName);\r\n\r\n                pass = msPass;\r\n            } else {\r\n                pass = ppl.addRenderPass(width, height, 'default');\r\n                pass.name = 'ForwardPass';\r\n\r\n                this._buildForwardMainLightPass(pass, id, camera,\r\n                    colorName, depthStencilName, depthStencilStoreOp, mainLight);\r\n            }\r\n            assert(pass !== undefined);\r\n\r\n            // Forward Lighting (Additive Lights)\r\n            this.forwardLighting.addLightQueues(\r\n                pass,\r\n                camera,\r\n                this._configs.mobileMaxSpotLightShadowMaps,\r\n            );\r\n\r\n            return pass;\r\n        }\r\n        public addPlanarShadowQueue(\r\n            camera: renderer.scene.Camera,\r\n            mainLight: renderer.scene.DirectionalLight | null,\r\n            pass: rendering.BasicRenderPassBuilder,\r\n        ) {\r\n            pass.addQueue(QueueHint.BLEND, 'planar-shadow')\r\n                .addScene(\r\n                    camera,\r\n                    SceneFlags.SHADOW_CASTER | SceneFlags.PLANAR_SHADOW | SceneFlags.BLEND,\r\n                    mainLight || undefined,\r\n                );\r\n        }\r\n        private _addForwardMultipleRadiancePasses(\r\n            ppl: rendering.BasicPipeline,\r\n            id: number,\r\n            camera: renderer.scene.Camera,\r\n            width: number,\r\n            height: number,\r\n            mainLight: renderer.scene.DirectionalLight | null,\r\n            colorName: string,\r\n            depthStencilName: string,\r\n            depthStencilStoreOp: gfx.StoreOp\r\n        ): rendering.BasicRenderPassBuilder {\r\n            assert(!this._cameraConfigs.singleForwardRadiancePass);\r\n\r\n            // Forward Lighting (Main Directional Light)\r\n            let pass = ppl.addRenderPass(width, height, 'default');\r\n            pass.name = 'ForwardPass';\r\n\r\n            const firstStoreOp = this.forwardLighting.isMultipleLightPassesNeeded()\r\n                ? StoreOp.STORE\r\n                : depthStencilStoreOp;\r\n\r\n            this._buildForwardMainLightPass(pass, id, camera,\r\n                colorName, depthStencilName, firstStoreOp, mainLight);\r\n\r\n            // Forward Lighting (Additive Lights)\r\n            pass = this.forwardLighting\r\n                .addLightPasses(colorName, depthStencilName, depthStencilStoreOp,\r\n                    id, width, height, camera, this._viewport, ppl, pass);\r\n\r\n            return pass;\r\n        }\r\n\r\n        private _buildReflectionProbePass(\r\n            pass: rendering.BasicRenderPassBuilder,\r\n            id: number,\r\n            camera: renderer.scene.Camera,\r\n            colorName: string,\r\n            depthStencilName: string,\r\n            mainLight: renderer.scene.DirectionalLight | null,\r\n            scene: renderer.RenderScene | null = null,\r\n        ): void {\r\n            // set viewport\r\n            const colorStoreOp = this._cameraConfigs.enableMSAA ? StoreOp.DISCARD : StoreOp.STORE;\r\n\r\n            // bind output render target\r\n            if (forwardNeedClearColor(camera)) {\r\n                this._reflectionProbeClearColor.x = camera.clearColor.x;\r\n                this._reflectionProbeClearColor.y = camera.clearColor.y;\r\n                this._reflectionProbeClearColor.z = camera.clearColor.z;\r\n                const clearColor = rendering.packRGBE(this._reflectionProbeClearColor);\r\n                this._clearColor.x = clearColor.x;\r\n                this._clearColor.y = clearColor.y;\r\n                this._clearColor.z = clearColor.z;\r\n                this._clearColor.w = clearColor.w;\r\n                pass.addRenderTarget(colorName, LoadOp.CLEAR, colorStoreOp, this._clearColor);\r\n            } else {\r\n                pass.addRenderTarget(colorName, LoadOp.LOAD, colorStoreOp);\r\n            }\r\n\r\n            // bind depth stencil buffer\r\n            if (camera.clearFlag & ClearFlagBit.DEPTH_STENCIL) {\r\n                pass.addDepthStencil(\r\n                    depthStencilName,\r\n                    LoadOp.CLEAR,\r\n                    StoreOp.DISCARD,\r\n                    camera.clearDepth,\r\n                    camera.clearStencil,\r\n                    camera.clearFlag & ClearFlagBit.DEPTH_STENCIL,\r\n                );\r\n            } else {\r\n                pass.addDepthStencil(depthStencilName, LoadOp.LOAD, StoreOp.DISCARD);\r\n            }\r\n\r\n            // Set shadow map if enabled\r\n            if (this._cameraConfigs.enableMainLightShadowMap) {\r\n                pass.addTexture(`ShadowMap${id}`, 'cc_shadowMap');\r\n            }\r\n\r\n            // TODO(zhouzhenglong): Separate OPAQUE and MASK queue\r\n\r\n            // add opaque and mask queue\r\n            pass.addQueue(QueueHint.NONE, 'reflect-map') // Currently we put OPAQUE and MASK into one queue, so QueueHint is NONE\r\n                .addScene(camera,\r\n                    SceneFlags.OPAQUE | SceneFlags.MASK | SceneFlags.REFLECTION_PROBE,\r\n                    mainLight || undefined,\r\n                    scene ? scene : undefined);\r\n        }\r\n\r\n        private _tryAddReflectionProbePasses(ppl: rendering.BasicPipeline, id: number,\r\n            mainLight: renderer.scene.DirectionalLight | null,\r\n            scene: renderer.RenderScene | null,\r\n        ): void {\r\n            const reflectionProbeManager = cclegacy.internal.reflectionProbeManager as ReflectionProbeManager | undefined;\r\n            if (!reflectionProbeManager) {\r\n                return;\r\n            }\r\n            const probes = reflectionProbeManager.getProbes();\r\n            const maxProbeCount = 4;\r\n            let probeID = 0;\r\n            for (const probe of probes) {\r\n                if (!probe.needRender) {\r\n                    continue;\r\n                }\r\n                const area = probe.renderArea();\r\n                const width = Math.max(Math.floor(area.x), 1);\r\n                const height = Math.max(Math.floor(area.y), 1);\r\n\r\n                if (probe.probeType === renderer.scene.ProbeType.PLANAR) {\r\n                    if (!this._cameraConfigs.enablePlanarReflectionProbe) {\r\n                        continue;\r\n                    }\r\n                    const window: renderer.RenderWindow = probe.realtimePlanarTexture!.window!;\r\n                    const colorName = `PlanarProbeRT${probeID}`;\r\n                    const depthStencilName = `PlanarProbeDS${probeID}`;\r\n                    // ProbeResource\r\n                    ppl.addRenderWindow(colorName,\r\n                        this._cameraConfigs.radianceFormat, width, height, window);\r\n                    ppl.addDepthStencil(depthStencilName,\r\n                        gfx.Format.DEPTH_STENCIL, width, height, ResourceResidency.MEMORYLESS);\r\n\r\n                    // Rendering\r\n                    const probePass = ppl.addRenderPass(width, height, 'default');\r\n                    probePass.name = `PlanarReflectionProbe${probeID}`;\r\n                    this._buildReflectionProbePass(probePass, id, probe.camera,\r\n                        colorName, depthStencilName, mainLight, scene);\r\n                } else if (EDITOR) {\r\n                    for (let faceIdx = 0; faceIdx < probe.bakedCubeTextures.length; faceIdx++) {\r\n                        probe.updateCameraDir(faceIdx);\r\n                        const window: renderer.RenderWindow = probe.bakedCubeTextures[faceIdx].window!;\r\n                        const colorName = `CubeProbeRT${probeID}${faceIdx}`;\r\n                        const depthStencilName = `CubeProbeDS${probeID}${faceIdx}`;\r\n                        // ProbeResource\r\n                        ppl.addRenderWindow(colorName,\r\n                            this._cameraConfigs.radianceFormat, width, height, window);\r\n                        ppl.addDepthStencil(depthStencilName,\r\n                            gfx.Format.DEPTH_STENCIL, width, height, ResourceResidency.MEMORYLESS);\r\n\r\n                        // Rendering\r\n                        const probePass = ppl.addRenderPass(width, height, 'default');\r\n                        probePass.name = `CubeProbe${probeID}${faceIdx}`;\r\n                        this._buildReflectionProbePass(probePass, id, probe.camera,\r\n                            colorName, depthStencilName, mainLight, scene);\r\n                    }\r\n                    probe.needRender = false;\r\n                }\r\n                ++probeID;\r\n                if (probeID === maxProbeCount) {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        private _initMaterials(ppl: rendering.BasicPipeline): number {\r\n            if (this._initialized) {\r\n                return 0;\r\n            }\r\n\r\n            setupPipelineConfigs(ppl, this._configs);\r\n\r\n            // When add new effect asset, please add its uuid to the dependentAssets in cc.config.json.\r\n            this._copyAndTonemapMaterial._uuid = `builtin-pipeline-tone-mapping-material`;\r\n            this._copyAndTonemapMaterial.initialize({ effectName: 'pipeline/post-process/tone-mapping' });\r\n\r\n            if (this._copyAndTonemapMaterial.effectAsset) {\r\n                this._initialized = true;\r\n            }\r\n\r\n            return this._initialized ? 0 : 1;\r\n        }\r\n    }\r\n\r\n    rendering.setCustomPipeline('Builtin', new BuiltinPipelineBuilder());\r\n\r\n} // if (rendering)\r\n"]}